/*!
 * ce-91.0.11335 c1320196184d3fabbc729c26ab6944d5b2935c64
 * Copyright 2013-2020 Evernote Corp. All rights reserved.
 * http://www.evernote.com
 * 
 */
(this.webpackJsonp=this.webpackJsonp||[]).push([[14],{1271:function(t,e,n){var r=n(1272);t.exports=function(t,e){return function(n,o){return r(n,t,e(o),{})}}},1272:function(t,e,n){var r=n(350);t.exports=function(t,e,n,o){return r(t,(function(t,r,i){e(o,n(t),r,i)})),o}},1561:function(t,e,n){(function(e,n){
/**
 * yjs - A framework for real-time p2p shared editing on any data
 * @version v13.0.0-63
 * @license MIT
 */
t.exports=function(){"use strict";function t(t,e,n,r){if(null===e)t.root=n,n._parent=null;else if(e.left===r)e.left=n;else{if(e.right!==r)throw new Error("The elements are wrongly connected!");e.right=n}}function r(t,e){var n=e._id;if(void 0===n)e._integrate(t);else{if(t.ss.getState(n.user)>n.clock)return;!t.gcEnabled||e.constructor===_t||e._parent.constructor!==_t&&!1===e._parent._deleted?e._integrate(t):e._gc(t);var r=t._missingStructs.get(n.user);if(null!=r)for(var o=n.clock,i=o+e._length;o<i;o++){var s=r.get(o);void 0!==s&&(s.forEach((function(e){if(0==--e.missing){var n=e.decoder,r=n.pos,o=e.struct._fromBinary(t,n);n.pos=r,0===o.length&&t._readyToIntegrate.push(e.struct)}})),r.delete(o))}}}function o(t,e,n){for(var r=e.readUint32(),o=0;o<r;o++){var i=new(L(e.readVarUint())),s=i._fromBinary(t,e),a="  "+i._logString();s.length>0&&(a+=" .. missing: "+s.map(f).join(", ")),n.push(a)}}function i(t,e){for(var n=e.readUint32(),o=0;o<n;o++){var i=new(L(e.readVarUint())),s=e.pos,a=i._fromBinary(t,e);if(0===a.length)for(;null!=i;)r(t,i),i=t._readyToIntegrate.shift();else{var c=new vt(e.uint8arr);c.pos=s;for(var u=new gt(c,a,i),l=t._missingStructs,h=a.length-1;h>=0;h--){var f=a[h];l.has(f.user)||l.set(f.user,new Map);var d=l.get(f.user);d.has(f.clock)||d.set(f.clock,[]),(d=d.get(f.clock)).push(u)}}}}function s(t,e){var n=null,r=void 0,o=void 0,i=0,s=e.pos;e.writeUint32(0),t.ds.iterate(null,null,(function(t){var s=t._id.user,a=t._id.clock,c=t.len,u=t.gc;n!==s&&(i++,null!==n&&e.setUint32(o,r),n=s,e.writeVarUint(s),o=e.pos,e.writeUint32(0),r=0),e.writeVarUint(a),e.writeVarUint(c),e.writeUint8(u?1:0),r++})),null!==n&&e.setUint32(o,r),e.setUint32(s,i)}function a(t,e){for(var n=e.readUint32(),r=0;r<n;r++)!function(n){for(var r=e.readVarUint(),o=[],i=e.readUint32(),s=0;s<i;s++){var a=e.readVarUint(),c=e.readVarUint(),u=1===e.readUint8();o.push([a,c,u])}if(i>0){var l=0,h=o[l],f=[];t.ds.iterate(new dt(r,0),new dt(r,Number.MAX_VALUE),(function(t){for(;null!=h;){var e=0;if(t._id.clock+t.len<=h[0])break;h[0]<t._id.clock?(e=Math.min(t._id.clock-h[0],h[1]),f.push([r,h[0],e])):(e=t._id.clock+t.len-h[0],h[2]&&!t.gc&&f.push([r,h[0],Math.min(e,h[1])])),h[1]<=e?h=o[++l]:(h[0]=h[0]+e,h[1]=h[1]-e)}}));for(var d=f.length-1;d>=0;d--){var y=f[d];p(t,y[0],y[1],y[2],!0)}for(;l<o.length;l++)h=o[l],p(t,r,h[0],h[1],!0)}}()}function c(t,e){var n=new mt;n.writeVarString(t.y.room),n.writeVarString("sync step 1"),n.writeVarString(t.authInfo||""),n.writeVarUint(t.protocolVersion),function(t,e){var n=e.pos,r=0;e.writeUint32(0);var o=!0,i=!1,s=void 0;try{for(var a,c=t.ss.state[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var u=lt(a.value,2),l=u[0],h=u[1];e.writeVarUint(l),e.writeVarUint(h),r++}}catch(t){i=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}e.setUint32(n,r)}(t.y,n),t.send(e,n.createBuffer())}function u(t,e,n){var r=e.pos;e.writeUint32(0);var o=0,i=!0,s=!1,a=void 0;try{for(var c,u=t.ss.state.keys()[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var l=c.value,h=n.get(l)||0;if(l!==Yt){var f=new dt(l,h),d=t.os.findPrev(f),p=null===d?null:d._id;null!==p&&p.user===l&&p.clock+d._length>h&&(d._clonePartial(h-p.clock)._toBinary(e),o++),t.os.iterate(f,new dt(l,Number.MAX_VALUE),(function(t){t._toBinary(e),o++}))}}}catch(t){s=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(s)throw a}}e.setUint32(r,o)}function l(t,e,n,r,o){var i=t.readVarUint();i!==n.connector.protocolVersion&&(console.warn("You tried to sync with a Yjs instance that has a different protocol version\n      (You: "+i+", Client: "+i+").\n      "),n.destroy()),e.writeVarString("sync step 2"),e.writeVarString(n.connector.authInfo||""),u(n,e,function(t){for(var e=new Map,n=t.readUint32(),r=0;r<n;r++){var o=t.readVarUint(),i=t.readVarUint();e.set(o,i)}return e}(t)),s(n,e),n.connector.send(r.uid,e.createBuffer()),r.receivedSyncStep2=!0,"slave"===n.connector.role&&c(n.connector,o)}function h(t,e,n,r,o){i(n,t),a(n,t),n.connector._setSyncedWith(o)}function f(t){if(null!==t&&null!=t._id&&(t=t._id),null===t)return"()";if(t instanceof dt)return"("+t.user+","+t.clock+")";if(t instanceof zt)return"("+t.name+","+t.type+")";if(t.constructor===Qt)return"y";throw new Error("This is not a valid ID!")}function d(t,e,n){var r=null!==e._left?e._left._lastId:null,o=null!==e._origin?e._origin._lastId:null;return t+"(id:"+f(e._id)+",left:"+f(r)+",origin:"+f(o)+",right:"+f(e._right)+",parent:"+f(e._parent)+",parentSub:"+e._parentSub+(void 0!==n?" - "+n:"")+")"}function p(t,e,n,r,o){var i=null!==t.connector&&t.connector._forwardAppliedStructs,s=t.os.getItemCleanStart(new dt(e,n));if(null!==s){s._deleted||(s._splitAt(t,r),s._delete(t,i,!0));var a=s._length;if(n+=a,(r-=a)>0)for(var c=t.os.findNode(new dt(e,n));null!==c&&null!==c.val&&r>0&&c.val._id.equals(new dt(e,n));){var u=c.val;u._deleted||(u._splitAt(t,r),u._delete(t,i,o));var l=u._length;r-=l,n+=l,c=c.next()}}}function y(t,e,n){if(e!==t&&!e._deleted&&!t._transaction.newTypes.has(e)){var r=t._transaction.changedTypes,o=r.get(e);void 0===o&&(o=new Set,r.set(e,o)),o.add(n)}}function v(t,e,n,r){var o=e._id;n._id=new dt(o.user,o.clock+r),n._origin=e,n._left=e,n._right=e._right,null!==n._right&&(n._right._left=n),n._right_origin=e._right_origin,e._right=n,n._parent=e._parent,n._parentSub=e._parentSub,n._deleted=e._deleted;var i=new Set;i.add(e);for(var s=n._right;null!==s&&i.has(s._origin);)s._origin===e&&(s._origin=n),i.add(s),s=s._right;t.os.put(n),t._transaction.newTypes.has(e)?t._transaction.newTypes.add(n):t._transaction.deletedStructs.has(e)&&t._transaction.deletedStructs.add(n)}function _(t,e){var n=void 0;do{n=e._right,e._right=null,e._right_origin=null,e._origin=e._left,e._integrate(t),e=n}while(null!==n)}function g(t,e){for(;null!==e;)e._delete(t,!1,!0),e._gc(t),e=e._right}function m(t,e,n,r,o){t._origin=r,t._left=r,t._right=o,t._right_origin=o,t._parent=e,null!==n?t._integrate(n):null===r?e._start=t:r._right=t}function b(t,e){return function(t,e,n,r,o){for(;null!==r&&o>0;){switch(r.constructor){case Dt:case Tt:if(o<=(r._deleted?0:r._length-1))return[n=(r=r._splitAt(e._y,o))._left,r,t];!1===r._deleted&&(o-=r._length);break;case Ut:!1===r._deleted&&w(t,r)}n=r,r=r._right}return[n,r,t]}(new Map,t,null,t._start,e)}function k(t,e,n,r,o){for(;null!==r&&(!0===r._deleted||r.constructor===Ut&&o.get(r.key)===r.value);)!1===r._deleted&&o.delete(r.key),n=r,r=r._right;var i=!0,s=!1,a=void 0;try{for(var c,u=o[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var l=lt(c.value,2),h=l[0],f=l[1],d=new Ut;d.key=h,d.value=f,m(d,e,t,n,r),n=d}}catch(t){s=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(s)throw a}}return[n,r]}function w(t,e){var n=e.value,r=e.key;null===n?t.delete(r):t.set(r,n)}function S(t,e,n,r){for(;null!==e;){if(!0===e._deleted);else{if(e.constructor!==Ut||(r[e.key]||null)!==e.value)break;w(n,e)}t=e,e=e._right}return[t,e]}function E(t,e,n,r,o,i){var s=new Map;for(var a in o){var c=o[a],u=i.get(a);if(u!==c){s.set(a,u||null);var l=new Ut;l.key=a,l.value=c,m(l,e,t,n,r),n=l}}return[n,r,s]}function O(t,e,n,r,o,i,s){var a=!0,c=!1,u=void 0;try{for(var l,h=i[Symbol.iterator]();!(a=(l=h.next()).done);a=!0){var f=lt(l.value,1)[0];void 0===s[f]&&(s[f]=null)}}catch(t){c=!0,u=t}finally{try{!a&&h.return&&h.return()}finally{if(c)throw u}}var d,p=S(r,o,i,s),y=lt(p,2),v=E(t,n,r=y[0],o=y[1],s,i),_=lt(v,3);r=_[0],o=_[1],d=_[2];var g=void 0;return e.constructor===String?(g=new Tt)._content=e:(g=new Dt).embed=e,m(g,n,t,r,o),k(t,n,r=g,o,d)}function T(t,e,n,r,o,i,s){var a=S(r,o,i,s),c=lt(a,2),u=void 0,l=E(t,n,r=c[0],o=c[1],s,i),h=lt(l,3);for(r=h[0],o=h[1],u=h[2];e>0&&null!==o;){if(!1===o._deleted)switch(o.constructor){case Ut:var f=s[o.key];void 0!==f&&(f===o.value?u.delete(o.key):u.set(o.key,o.value),o._delete(t)),w(i,o);break;case Dt:case Tt:o._splitAt(t,e),e-=o._length}r=o,o=o._right}return k(t,n,r,o,u)}function A(t,e,n,r,o,i){for(;e>0&&null!==o;){if(!1===o._deleted)switch(o.constructor){case Ut:w(i,o);break;case Dt:case Tt:o._splitAt(t,e),e-=o._length,o._delete(t)}r=o,o=o._right}return[r,o]}function I(t,e){for(e=e._parent;null!==e;){if(e===t)return!0;e=e._parent}return!1}function N(t,e){return e}function B(t,e,n){if(I(e.type,n)){var r=n.nodeName,o=new Map;if(void 0!==n.getAttributes){var i=n.getAttributes();for(var s in i)o.set(s,i[s])}var a=e.filter(r,new Map(o));null===a?n._delete(t):o.forEach((function(t,e){!1===a.has(e)&&n.removeAttribute(e)}))}}function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N,o=arguments[4],i=void 0;switch(t.nodeType){case e.ELEMENT_NODE:var s=null,a=void 0;if(t.hasAttribute("data-yjs-hook")&&void 0===(a=n[s=t.getAttribute("data-yjs-hook")])&&(console.error('Unknown hook "'+s+'". Deleting yjsHook dataset property.'),t.removeAttribute("data-yjs-hook"),s=null),null===s){var c=function(t,e){for(var n=new Map,r=t.attributes.length-1;r>=0;r--){var o=t.attributes[r];n.set(o.name,o.value)}return e(t.nodeName,n)}(t,r);null===c?i=!1:(i=new Ht(t.nodeName),c.forEach((function(t,e){i.setAttribute(e,t)})),i.insert(0,P(t.childNodes,document,n,r,o)))}else i=new Rt(s),a.fillType(t,i);break;case e.TEXT_NODE:(i=new Vt).insert(0,t.nodeValue);break;default:throw new Error("Can't transform this node type to a YXml type!")}return x(o,t,i),i}function D(t){for(;null!==t&&t._deleted;)t=t._right;return t}function U(t,e,n){t.domToType.delete(e),t.typeToDom.delete(n)}function x(t,e,n){void 0!==t&&(t.domToType.set(e,n),t.typeToDom.set(n,e))}function P(t,e,n,r,o){var i=[],s=!0,a=!1,c=void 0;try{for(var u,l=t[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var h=C(u.value,e,n,r,o);!1!==h&&i.push(h)}}catch(t){a=!0,c=t}finally{try{!s&&l.return&&l.return()}finally{if(a)throw c}}return i}function R(t,e,n,r,o){var i=function(t,e,n,r,o){var i=P(n,r,o.opts.hooks,o.filter,o);return t.insertAfter(e,i)}(t,e,[n],r,o);return i.length>0?i[0]:e}function j(t,e,n){for(;e!==n;){var r=e;e=e.nextSibling,t.removeChild(r)}}function M(t,e){qt.set(t,e),Wt.set(e,t)}function L(t){return qt.get(t)}function H(t){return Wt.get(t)}function V(t,e){for(var n=t._start;null!==n;){if(!1===n._deleted){if(n._length>e)return[n._id.user,n._id.clock+e];e-=n._length}n=n._right}return["endof",t._id.user,t._id.clock||null,t._id.name||null,t._id.type||null]}function q(t,e){if("endof"===e[0]){var n;n=null===e[3]?new dt(e[1],e[2]):new zt(e[3],e[4]);for(var r=t.os.get(n);null!==r._redone;)r=r._redone;return null===r||r.constructor===_t?null:{type:r,offset:r.length}}for(var o=0,i=t.os.findNodeWithUpperBound(new dt(e[0],e[1])).val,s=e[1]-i._id.clock;null!==i._redone;)i=i._redone;var a=i._parent;if(i.constructor===_t||a._deleted)return null;for(i._deleted||(o=s),i=i._left;null!==i;)i._deleted||(o+=i._length),i=i._left;return{type:a,offset:o}}function W(){var t=!0;return function(e){if(t){t=!1;try{e()}catch(t){console.error(t)}t=!0}}}function Y(t){var e=this;this._mutualExclude((function(){var n=function(t){if(null!==t){var e=getSelection().anchorNode;if(null!=e)return e.nodeType===document.TEXT_NODE&&(e=e.parentElement),{elem:e,top:e.getBoundingClientRect().top};for(var n=t.children,r=0;r<n.length;r++){var o=n[r],i=o.getBoundingClientRect();if(i.top>=0)return{elem:o,top:i.top}}}return null}(e.scrollingElement);t.forEach((function(t){var n=t.target,r=e.typeToDom.get(n);if(void 0!==r&&!1!==r)if(n.constructor===Vt)r.nodeValue=n.toString();else if(void 0!==t.attributesChanged&&(t.attributesChanged.forEach((function(t){var e=n.getAttribute(t);void 0===e?r.removeAttribute(t):r.setAttribute(t,e)})),t.childListChanged&&n.constructor!==Rt)){var o=r.firstChild;n.forEach((function(t){var n=e.typeToDom.get(t);switch(n){case void 0:var i=t.toDom(e.opts.document,e.opts.hooks,e);r.insertBefore(i,o);break;case!1:break;default:j(r,o,n),o=n.nextSibling}})),j(r,o,null)}})),function(t,e){if(null!==e){var n=e.elem,r=e.top,o=n.getBoundingClientRect().top,i=t.scrollTop+o-r;i>=0&&(t.scrollTop=i)}}(e.scrollingElement,n)}))}function z(t,e){for(var n=0,r=0;n<t.length&&n<e.length&&t[n]===e[n];)n++;if(n!==t.length||n!==e.length)for(;r+n<t.length&&r+n<e.length&&t[t.length-r-1]===e[e.length-r-1];)r++;return{pos:n,remove:t.length-n-r,insert:e.slice(n,e.length-r)}}function J(t,e,n,r){if(null!=n&&!1!==n&&n.constructor!==Rt){for(var o=n._y,i=new Set,s=e.childNodes.length-1;s>=0;s--){var a=t.domToType.get(e.childNodes[s]);void 0!==a&&!1!==a&&i.add(a)}n.forEach((function(e){!1===i.has(e)&&(e._delete(o),U(t,t.typeToDom.get(e),e))}));for(var c=e.childNodes,u=c.length,l=null,h=D(n._start),f=0;f<u;f++){var d=c[f],p=t.domToType.get(d);if(void 0!==p){if(!1===p)continue;null!==h?h!==p?(p._parent!==n?U(t,d,p):(U(t,d,p),p._delete(o)),l=R(n,l,d,r,t)):(l=h,h=D(h._right)):l=R(n,l,d,r,t)}else l=R(n,l,d,r,t)}}}function X(t,e){var n=this;this._mutualExclude((function(){n.type._y.transact((function(){var r=new Set;t.forEach((function(t){var e=t.target,o=n.domToType.get(e);if(void 0!==o){if(!1!==o&&o.constructor!==Rt)switch(t.type){case"characterData":var i=z(o.toString(),e.nodeValue);o.delete(i.pos,i.remove),o.insert(i.pos,i.insert);break;case"attributes":if(o.constructor===Lt)break;var s=t.attributeName,a=e.getAttribute(s),c=new Map;c.set(s,a),o.constructor!==Lt&&n.filter(e.nodeName,c).size>0&&o.getAttribute(s)!==a&&(null==a?o.removeAttribute(s):o.setAttribute(s,a));break;case"childList":r.add(t.target)}}else{var u=e,l=void 0;do{u=u.parentElement,l=n.domToType.get(u)}while(void 0===l&&null!==u);!1!==l&&void 0!==l&&l.constructor!==Rt&&r.add(u)}}));var o=!0,i=!1,s=void 0;try{for(var a,c=r[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var u=a.value,l=n.domToType.get(u);J(n,u,l,e)}}catch(t){i=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}))}))}function F(t,e,n){var r=!1,o=void 0;return t.transact((function(){for(;!r&&n.length>0;)!function(){null!==(o=n.pop()).fromState&&(t.os.getItemCleanStart(o.fromState),t.os.getItemCleanEnd(o.toState),t.os.iterate(o.fromState,o.toState,(function(n){for(;n._deleted&&null!==n._redone;)n=n._redone;!1===n._deleted&&I(e,n)&&(r=!0,n._delete(t))})));var i=new Set,s=!0,a=!1,c=void 0;try{for(var u,l=o.deletedStructs[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var h=u.value,f=h.from,d=new dt(f.user,f.clock+h.len-1);t.os.getItemCleanStart(f),t.os.getItemCleanEnd(d),t.os.iterate(f,d,(function(n){I(e,n)&&n._parent!==t&&(n._id.user!==t.userID||null===o.fromState||n._id.clock<o.fromState.clock||n._id.clock>o.toState.clock)&&i.add(n)}))}}catch(t){a=!0,c=t}finally{try{!s&&l.return&&l.return()}finally{if(a)throw c}}i.forEach((function(e){var n=e._redo(t,i);r=r||n}))}()})),r&&o.bindingInfos.forEach((function(t,e){e._restoreUndoStackInfo(t)})),r}function K(t,e){return t(e={exports:{}},e.exports),e.exports}function G(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}function $(t,e){t.transact((function(){i(t,e),a(t,e)}))}function Z(t){var e=new mt;return u(t,e,new Map),s(t,e),e}function Q(){var t=new mt;return t.writeUint32(0),{len:0,buffer:t}}function tt(){var t=this;this._mutualExclude((function(){var e=t.target,n=t.type,r=V(n,e.selectionStart),o=V(n,e.selectionEnd);e.value=n.toString();var i=q(n._y,r),s=q(n._y,o);e.setSelectionRange(i,s)}))}function et(){var t=this;this._mutualExclude((function(){var e=z(t.type.toString(),t.target.value);t.type.delete(e.pos,e.remove),t.type.insert(e.pos,e.insert)}))}function nt(t){var e=this.target;e.update("yjs"),this._mutualExclude((function(){e.updateContents(t.delta,"yjs"),e.update("yjs")}))}function rt(t){var e=this;this._mutualExclude((function(){e.type.applyDelta(t.ops)}))}var ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},st=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),at=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},ct=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},ut=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},lt=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},ht=function(){function e(t){it(this,e),this.val=t,this.color=!0,this._left=null,this._right=null,this._parent=null}return st(e,[{key:"isRed",value:function(){return this.color}},{key:"isBlack",value:function(){return!this.color}},{key:"redden",value:function(){return this.color=!0,this}},{key:"blacken",value:function(){return this.color=!1,this}},{key:"rotateLeft",value:function(e){var n=this.parent,r=this.right,o=this.right.left;r.left=this,this.right=o,t(e,n,r,this)}},{key:"next",value:function(){if(null!==this.right){for(var t=this.right;null!==t.left;)t=t.left;return t}for(var e=this;null!==e.parent&&e!==e.parent.left;)e=e.parent;return e.parent}},{key:"prev",value:function(){if(null!==this.left){for(var t=this.left;null!==t.right;)t=t.right;return t}for(var e=this;null!==e.parent&&e!==e.parent.right;)e=e.parent;return e.parent}},{key:"rotateRight",value:function(e){var n=this.parent,r=this.left,o=this.left.right;r.right=this,this.left=o,t(e,n,r,this)}},{key:"getUncle",value:function(){return this.parent===this.parent.parent.left?this.parent.parent.right:this.parent.parent.left}},{key:"grandparent",get:function(){return this.parent.parent}},{key:"parent",get:function(){return this._parent}},{key:"sibling",get:function(){return this===this.parent.left?this.parent.right:this.parent.left}},{key:"left",get:function(){return this._left},set:function(t){null!==t&&(t._parent=this),this._left=t}},{key:"right",get:function(){return this._right},set:function(t){null!==t&&(t._parent=this),this._right=t}}]),e}(),ft=function(){function t(){it(this,t),this.root=null,this.length=0}return st(t,[{key:"findNext",value:function(t){var e=t.clone();return e.clock+=1,this.findWithLowerBound(e)}},{key:"findPrev",value:function(t){var e=t.clone();return e.clock-=1,this.findWithUpperBound(e)}},{key:"findNodeWithLowerBound",value:function(t){var e=this.root;if(null===e)return null;for(;;)if(null===t||t.lessThan(e.val._id)&&null!==e.left)e=e.left;else{if(null===t||!e.val._id.lessThan(t))return e;if(null===e.right)return e.next();e=e.right}}},{key:"findNodeWithUpperBound",value:function(t){if(void 0===t)throw new Error("You must define from!");var e=this.root;if(null===e)return null;for(;;)if(null!==t&&!e.val._id.lessThan(t)||null===e.right){if(null===t||!t.lessThan(e.val._id))return e;if(null===e.left)return e.prev();e=e.left}else e=e.right}},{key:"findSmallestNode",value:function(){for(var t=this.root;null!=t&&null!=t.left;)t=t.left;return t}},{key:"findWithLowerBound",value:function(t){var e=this.findNodeWithLowerBound(t);return null==e?null:e.val}},{key:"findWithUpperBound",value:function(t){var e=this.findNodeWithUpperBound(t);return null==e?null:e.val}},{key:"iterate",value:function(t,e,n){var r;for(r=null===t?this.findSmallestNode():this.findNodeWithLowerBound(t);null!==r&&(null===e||r.val._id.lessThan(e)||r.val._id.equals(e));)n(r.val),r=r.next()}},{key:"find",value:function(t){var e=this.findNode(t);return null!==e?e.val:null}},{key:"findNode",value:function(t){var e=this.root;if(null===e)return null;for(;;){if(null===e)return null;if(t.lessThan(e.val._id))e=e.left;else{if(!e.val._id.lessThan(t))return e;e=e.right}}}},{key:"delete",value:function(t){var e=this.findNode(t);if(null!=e){if(this.length--,null!==e.left&&null!==e.right){for(var n=e.left;null!==n.right;)n=n.right;e.val=n.val,e=n}var r,o=e.left||e.right;if(null===o?(r=!0,(o=new ht(null)).blacken(),e.right=o):r=!1,null===e.parent)return void(r?this.root=null:(this.root=o,o.blacken(),o._parent=null));if(e.parent.left===e)e.parent.left=o;else{if(e.parent.right!==e)throw new Error("Impossible!");e.parent.right=o}if(e.isBlack()&&(o.isRed()?o.blacken():this._fixDelete(o)),this.root.blacken(),r)if(o.parent.left===o)o.parent.left=null;else{if(o.parent.right!==o)throw new Error("Impossible #3");o.parent.right=null}}}},{key:"_fixDelete",value:function(t){function e(t){return null===t||t.isBlack()}function n(t){return null!==t&&t.isRed()}if(null!==t.parent){var r=t.sibling;if(n(r)){if(t.parent.redden(),r.blacken(),t===t.parent.left)t.parent.rotateLeft(this);else{if(t!==t.parent.right)throw new Error("Impossible #2");t.parent.rotateRight(this)}r=t.sibling}t.parent.isBlack()&&r.isBlack()&&e(r.left)&&e(r.right)?(r.redden(),this._fixDelete(t.parent)):t.parent.isRed()&&r.isBlack()&&e(r.left)&&e(r.right)?(r.redden(),t.parent.blacken()):(t===t.parent.left&&r.isBlack()&&n(r.left)&&e(r.right)?(r.redden(),r.left.blacken(),r.rotateRight(this),r=t.sibling):t===t.parent.right&&r.isBlack()&&n(r.right)&&e(r.left)&&(r.redden(),r.right.blacken(),r.rotateLeft(this),r=t.sibling),r.color=t.parent.color,t.parent.blacken(),t===t.parent.left?(r.right.blacken(),t.parent.rotateLeft(this)):(r.left.blacken(),t.parent.rotateRight(this)))}}},{key:"put",value:function(t){var e=new ht(t);if(null!==this.root){for(var n=this.root;;)if(e.val._id.lessThan(n.val._id)){if(null===n.left){n.left=e;break}n=n.left}else{if(!n.val._id.lessThan(e.val._id))return n.val=e.val,n;if(null===n.right){n.right=e;break}n=n.right}this._fixInsert(e)}else this.root=e;return this.length++,this.root.blacken(),e}},{key:"_fixInsert",value:function(t){if(null!==t.parent){if(!t.parent.isBlack()){var e=t.getUncle();null!==e&&e.isRed()?(t.parent.blacken(),e.blacken(),t.grandparent.redden(),this._fixInsert(t.grandparent)):(t===t.parent.right&&t.parent===t.grandparent.left?(t.parent.rotateLeft(this),t=t.left):t===t.parent.left&&t.parent===t.grandparent.right&&(t.parent.rotateRight(this),t=t.right),t.parent.blacken(),t.grandparent.redden(),t===t.parent.left?t.grandparent.rotateRight(this):t.grandparent.rotateLeft(this))}}else t.blacken()}}]),t}(),dt=function(){function t(e,n){it(this,t),this.user=e,this.clock=n}return st(t,[{key:"clone",value:function(){return new t(this.user,this.clock)}},{key:"equals",value:function(t){return null!==t&&t.user===this.user&&t.clock===this.clock}},{key:"lessThan",value:function(e){return e.constructor===t&&(this.user<e.user||this.user===e.user&&this.clock<e.clock)}}]),t}(),pt=function(){function t(e,n,r){it(this,t),this._id=e,this.len=n,this.gc=r}return st(t,[{key:"clone",value:function(){return new t(this._id,this.len,this.gc)}}]),t}(),yt=function(t){function e(){return it(this,e),ut(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ct(e,t),st(e,[{key:"logTable",value:function(){var t=[];this.iterate(null,null,(function(e){t.push({user:e._id.user,clock:e._id.clock,len:e.len,gc:e.gc})})),console.table(t)}},{key:"isDeleted",value:function(t){var e=this.findWithUpperBound(t);return null!==e&&e._id.user===t.user&&t.clock<e._id.clock+e.len}},{key:"mark",value:function(t,e,n){if(0!==e){var r=this.findWithUpperBound(new dt(t.user,t.clock-1));null!==r&&r._id.user===t.user&&r._id.clock<t.clock&&t.clock<r._id.clock+r.len&&(t.clock+e<r._id.clock+r.len&&this.put(new pt(new dt(t.user,t.clock+e),r._id.clock+r.len-t.clock-e,r.gc)),r.len=t.clock-r._id.clock);var o=new dt(t.user,t.clock+e-1),i=this.findWithUpperBound(o);if(null!==i&&i._id.user===t.user&&i._id.clock<t.clock+e&&t.clock<=i._id.clock&&t.clock+e<i._id.clock+i.len){var s=t.clock+e-i._id.clock;i._id=new dt(i._id.user,i._id.clock+s),i.len-=s}var a=[];this.iterate(t,o,(function(t){a.push(t._id)}));for(var c=a.length-1;c>=0;c--)this.delete(a[c]);var u=new pt(t,e,n);null!==r&&r._id.user===t.user&&r._id.clock+r.len===t.clock&&r.gc===n&&(r.len+=e,u=r);var l=this.find(new dt(t.user,t.clock+e));null!==l&&l._id.user===t.user&&t.clock+e===l._id.clock&&n===l.gc&&(u.len+=l.len,this.delete(l._id)),r!==u&&this.put(u)}}},{key:"markDeleted",value:function(t,e){this.mark(t,e,!1)}}]),e}(ft),vt=function(){function t(n){if(it(this,t),n instanceof ArrayBuffer)this.uint8arr=new Uint8Array(n);else{if(!(n instanceof Uint8Array||void 0!==e&&n instanceof e))throw new Error("Expected an ArrayBuffer or Uint8Array!");this.uint8arr=n}this.pos=0}return st(t,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pos,n=new t(this.uint8arr);return n.pos=e,n}},{key:"skip8",value:function(){this.pos++}},{key:"readUint8",value:function(){return this.uint8arr[this.pos++]}},{key:"readUint32",value:function(){var t=this.uint8arr[this.pos]+(this.uint8arr[this.pos+1]<<8)+(this.uint8arr[this.pos+2]<<16)+(this.uint8arr[this.pos+3]<<24);return this.pos+=4,t}},{key:"peekUint8",value:function(){return this.uint8arr[this.pos]}},{key:"readVarUint",value:function(){for(var t=0,e=0;;){var n=this.uint8arr[this.pos++];if(t|=(127&n)<<e,n<128)return t>>>0;if((e+=7)>35)throw new Error("Integer out of range!")}}},{key:"readVarString",value:function(){for(var t=this.readVarUint(),e=new Array(t),n=0;n<t;n++)e[n]=this.uint8arr[this.pos++];var r=e.map((function(t){return String.fromCodePoint(t)})).join("");return decodeURIComponent(escape(r))}},{key:"peekVarString",value:function(){var t=this.pos,e=this.readVarString();return this.pos=t,e}},{key:"readID",value:function(){var t=this.readVarUint();if(t===Yt){var e=new zt(this.readVarString(),null);return e.type=this.readVarUint(),e}return new dt(t,this.readVarUint())}},{key:"length",get:function(){return this.uint8arr.length}}]),t}(),_t=function(){function t(){it(this,t),this._id=null,this._length=0}return st(t,[{key:"_integrate",value:function(e){var n=this._id,r=e.ss.getState(n.user);n.clock===r&&e.ss.setState(n.user,n.clock+this._length),e.ds.mark(this._id,this._length,!0);var o=e.os.put(this),i=o.prev().val;null!==i&&i.constructor===t&&i._id.user===o.val._id.user&&i._id.clock+i._length===o.val._id.clock&&(i._length+=o.val._length,e.os.delete(o.val._id),o=i),o.val&&(o=o.val);var s=e.os.findNext(o._id);null!==s&&s.constructor===t&&s._id.user===o._id.user&&s._id.clock===o._id.clock+o._length&&(o._length+=s._length,e.os.delete(s._id)),n.user!==Yt&&(null===e.connector||!e.connector._forwardAppliedStructs&&n.user!==e.userID||e.connector.broadcastStruct(this),null!==e.persistence&&e.persistence.saveStruct(e,this))}},{key:"_toBinary",value:function(t){t.writeUint8(H(this.constructor)),t.writeID(this._id),t.writeVarUint(this._length)}},{key:"_fromBinary",value:function(t,e){var n=e.readID();this._id=n,this._length=e.readVarUint();var r=[];return t.ss.getState(n.user)<n.clock&&r.push(new dt(n.user,n.clock-1)),r}},{key:"_splitAt",value:function(){return this}},{key:"_clonePartial",value:function(e){var n=new t;return n._id=new dt(this._id.user,this._id.clock+e),n._length=this._length-e,n}},{key:"_deleted",get:function(){return!0}}]),t}(),gt=function t(e,n,r){it(this,t),this.decoder=e,this.missing=n.length,this.struct=r},mt=function(){function t(){it(this,t),this.data=[]}return st(t,[{key:"createBuffer",value:function(){return Uint8Array.from(this.data).buffer}},{key:"writeUint8",value:function(t){this.data.push(255&t)}},{key:"setUint8",value:function(t,e){this.data[t]=255&e}},{key:"writeUint16",value:function(t){this.data.push(255&t,t>>>8&255)}},{key:"setUint16",value:function(t,e){this.data[t]=255&e,this.data[t+1]=e>>>8&255}},{key:"writeUint32",value:function(t){for(var e=0;e<4;e++)this.data.push(255&t),t>>>=8}},{key:"setUint32",value:function(t,e){for(var n=0;n<4;n++)this.data[t+n]=255&e,e>>>=8}},{key:"writeVarUint",value:function(t){for(;t>=128;)this.data.push(128|127&t),t>>>=7;this.data.push(127&t)}},{key:"writeVarString",value:function(t){var e=unescape(encodeURIComponent(t)).split("").map((function(t){return t.codePointAt()})),n=e.length;this.writeVarUint(n);for(var r=0;r<n;r++)this.data.push(e[r])}},{key:"writeID",value:function(t){var e=t.user;this.writeVarUint(e),e!==Yt?this.writeVarUint(t.clock):(this.writeVarString(t.name),this.writeVarUint(t.type))}},{key:"length",get:function(){return this.data.length}},{key:"pos",get:function(){return this.data.length}}]),t}(),bt=function(){function t(){it(this,t),this._target=null,this._length=null}return st(t,[{key:"_fromBinary",value:function(t,e){var n=e.readID();return this._targetID=n,this._length=e.readVarUint(),null===t.os.getItem(n)?[n]:[]}},{key:"_toBinary",value:function(t){t.writeUint8(H(this.constructor)),t.writeID(this._targetID),t.writeVarUint(this._length)}},{key:"_integrate",value:function(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])null!==t.connector&&t.connector.broadcastStruct(this);else{var e=this._targetID;p(t,e.user,e.clock,this._length,!1)}null!==t.persistence&&t.persistence.saveStruct(t,this)}},{key:"_logString",value:function(){return"Delete - target: "+f(this._targetID)+", len: "+this._length}}]),t}(),kt=function t(e){it(this,t),this.y=e,this.newTypes=new Set,this.changedTypes=new Map,this.deletedStructs=new Set,this.beforeState=new Map,this.changedParentTypes=new Map},wt=function(){function t(){it(this,t),this._id=null,this._origin=null,this._left=null,this._right=null,this._right_origin=null,this._parent=null,this._parentSub=null,this._deleted=!1,this._redone=null}return st(t,[{key:"_copy",value:function(){return new this.constructor}},{key:"_redo",value:function(t,e){if(null!==this._redone)return this._redone;var n=this._copy(),r=void 0,o=void 0;null===this._parentSub?(r=this._left,o=this):(r=null,(o=this._parent._map.get(this._parentSub))._delete(t));var i=this._parent;if(!(!0!==i._deleted||null!==i._redone||e.has(i)&&i._redo(t,e)))return!1;if(null!==i._redone){for(i=i._redone;null!==r;){if(null!==r._redone&&r._redone._parent===i){r=r._redone;break}r=r._left}for(;null!==o;)null!==o._redone&&o._redone._parent===i&&(o=o._redone),o=o._right}return n._origin=r,n._left=r,n._right=o,n._right_origin=o,n._parent=i,n._parentSub=this._parentSub,n._integrate(t),this._redone=n,!0}},{key:"_splitAt",value:function(t,e){return 0===e?this:this._right}},{key:"_delete",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._deleted){this._deleted=!0,t.ds.mark(this._id,this._length,!1);var n=new bt;n._targetID=this._id,n._length=this._length,e?n._integrate(t,!0):null!==t.persistence&&t.persistence.saveStruct(t,n),y(t,this._parent,this._parentSub),t._transaction.deletedStructs.add(this)}}},{key:"_gcChildren",value:function(t){}},{key:"_gc",value:function(t){var e=new _t;e._id=this._id,e._length=this._length,t.os.delete(this._id),e._integrate(t)}},{key:"_beforeChange",value:function(){}},{key:"_integrate",value:function(t){t._transaction.newTypes.add(this);var e=this._parent,n=this._id,r=null===n?t.userID:n.user,o=t.ss.getState(r);if(null===n)this._id=t.ss.getNextID(this._length);else if(n.user===Yt);else{if(n.clock<o)return[];if(n.clock!==o)throw new Error("Can not apply yet!");t.ss.setState(n.user,o+this._length)}e._deleted||t._transaction.changedTypes.has(e)||t._transaction.newTypes.has(e)||this._parent._beforeChange();var i=void 0;i=null!==this._left?this._left._right:null!==this._parentSub?this._parent._map.get(this._parentSub)||null:this._parent._start;for(var s=new Set,a=new Set;null!==i&&i!==this._right;){if(a.add(i),s.add(i),this._origin===i._origin)i._id.user<this._id.user&&(this._left=i,s.clear());else{if(!a.has(i._origin))break;s.has(i._origin)||(this._left=i,s.clear())}i=i._right}var c=this._parentSub;if(null===this._left){var u=void 0;if(null!==c){var l=e._map;u=l.get(c)||null,l.set(c,this)}else u=e._start,e._start=this;this._right=u,null!==u&&(u._left=this)}else{var h=this._left,f=h._right;this._right=f,h._right=this,null!==f&&(f._left=this)}e._deleted&&this._delete(t,!1),t.os.put(this),y(t,e,c),this._id.user!==Yt&&(null===t.connector||!t.connector._forwardAppliedStructs&&this._id.user!==t.userID||t.connector.broadcastStruct(this),null!==t.persistence&&t.persistence.saveStruct(t,this))}},{key:"_toBinary",value:function(t){t.writeUint8(H(this.constructor));var e=0;null!==this._origin&&(e+=1),null!==this._right_origin&&(e+=4),null!==this._parentSub&&(e+=8),t.writeUint8(e),t.writeID(this._id),1&e&&t.writeID(this._origin._lastId),4&e&&t.writeID(this._right_origin._id),0==(5&e)&&t.writeID(this._parent._id),8&e&&t.writeVarString(JSON.stringify(this._parentSub))}},{key:"_fromBinary",value:function(t,e){var n=[],r=e.readUint8(),o=e.readID();if(this._id=o,1&r){var i=e.readID(),s=t.os.getItemCleanEnd(i);null===s?n.push(i):(this._origin=s,this._left=this._origin)}if(4&r){var a=e.readID(),c=t.os.getItemCleanStart(a);null===c?n.push(a):(this._right=c,this._right_origin=c)}if(0==(5&r)){var u,l=e.readID();if(null===this._parent)null===(u=l.constructor===zt?t.os.get(l):t.os.getItem(l))?n.push(l):this._parent=u}else null===this._parent&&(null!==this._origin?this._origin.constructor===_t?this._parent=this._origin:this._parent=this._origin._parent:null!==this._right_origin&&(this._right_origin.constructor===_t?this._parent=this._right_origin:this._parent=this._right_origin._parent));return 8&r&&(this._parentSub=JSON.parse(e.readVarString())),t.ss.getState(o.user)<o.clock&&n.push(new dt(o.user,o.clock-1)),n}},{key:"_lastId",get:function(){return new dt(this._id.user,this._id.clock+this._length-1)}},{key:"_length",get:function(){return 1}},{key:"_countable",get:function(){return!0}}]),t}(),St=function(){function t(){it(this,t),this.eventListeners=[]}return st(t,[{key:"destroy",value:function(){this.eventListeners=null}},{key:"addEventListener",value:function(t){this.eventListeners.push(t)}},{key:"removeEventListener",value:function(t){this.eventListeners=this.eventListeners.filter((function(e){return t!==e}))}},{key:"removeAllEventListeners",value:function(){this.eventListeners=[]}},{key:"callEventListeners",value:function(t,e){for(var n=0;n<this.eventListeners.length;n++)try{(0,this.eventListeners[n])(e)}catch(t){console.error(t)}}}]),t}(),Et=function(t){function e(){it(this,e);var t=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._map=new Map,t._start=null,t._y=null,t._eventHandler=new St,t._deepEventHandler=new St,t}return ct(e,t),st(e,[{key:"getPathTo",value:function(t){if(t===this)return[];for(var e=[],n=this._y;t!==this&&t!==n;){var r=t._parent;if(null!==t._parentSub)e.unshift(t._parentSub);else{var o=!0,i=!1,s=void 0;try{for(var a,c=r[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var u=lt(a.value,2),l=u[0];if(u[1]===t){e.unshift(l);break}}}catch(t){i=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}t=r}if(t!==this)throw new Error("The type is not a child of this node");return e}},{key:"_callEventHandler",value:function(t,e){var n=t.changedParentTypes;this._eventHandler.callEventListeners(t,e);for(var r=this;r!==this._y;){var o=n.get(r);void 0===o&&(o=[],n.set(r,o)),o.push(e),r=r._parent}}},{key:"_transact",value:function(t){var e=this._y;null!==e?e.transact(t):t(e)}},{key:"observe",value:function(t){this._eventHandler.addEventListener(t)}},{key:"observeDeep",value:function(t){this._deepEventHandler.addEventListener(t)}},{key:"unobserve",value:function(t){this._eventHandler.removeEventListener(t)}},{key:"unobserveDeep",value:function(t){this._deepEventHandler.removeEventListener(t)}},{key:"_integrate",value:function(t){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_integrate",this).call(this,t),this._y=t;var n=this._start;null!==n&&(this._start=null,_(t,n));var r=this._map;this._map=new Map;var o=!0,i=!1,s=void 0;try{for(var a,c=r.values()[Symbol.iterator]();!(o=(a=c.next()).done);o=!0)_(t,a.value)}catch(t){i=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}},{key:"_gcChildren",value:function(t){g(t,this._start),this._start=null,this._map.forEach((function(e){g(t,e)})),this._map=new Map}},{key:"_gc",value:function(t){this._gcChildren(t),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_gc",this).call(this,t)}},{key:"_delete",value:function(t,n,r){void 0!==r&&t.gcEnabled||(r=!1===t._hasUndoManager&&t.gcEnabled),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_delete",this).call(this,t,n,r),t._transaction.changedTypes.delete(this);var o=!0,i=!1,s=void 0;try{for(var a,c=this._map.values()[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var u=a.value;u instanceof wt&&!u._deleted&&u._delete(t,!1,r)}}catch(t){i=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}for(var l=this._start;null!==l;)l._deleted||l._delete(t,!1,r),l=l._right;r&&this._gcChildren(t)}}]),e}(wt),Ot=function(t){function e(){it(this,e);var t=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._content=null,t}return ct(e,t),st(e,[{key:"_copy",value:function(){var t=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_copy",this).call(this);return t._content=this._content,t}},{key:"_fromBinary",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_fromBinary",this).call(this,t,n),o=n.readVarUint();this._content=new Array(o);for(var i=0;i<o;i++){var s,a=n.readVarString();s="undefined"===a?void 0:JSON.parse(a),this._content[i]=s}return r}},{key:"_toBinary",value:function(t){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_toBinary",this).call(this,t);var n=this._content.length;t.writeVarUint(n);for(var r=0;r<n;r++){var o,i=this._content[r];o=void 0===i?"undefined":JSON.stringify(i),t.writeVarString(o)}}},{key:"_logString",value:function(){return d("ItemJSON",this,"content:"+JSON.stringify(this._content))}},{key:"_splitAt",value:function(t,n){if(0===n)return this;if(n>=this._length)return this._right;var r=new e;return r._content=this._content.splice(n),v(t,this,r,n),r}},{key:"_length",get:function(){return this._content.length}}]),e}(wt),Tt=function(t){function e(){it(this,e);var t=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._content=null,t}return ct(e,t),st(e,[{key:"_copy",value:function(){var t=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_copy",this).call(this);return t._content=this._content,t}},{key:"_fromBinary",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_fromBinary",this).call(this,t,n);return this._content=n.readVarString(),r}},{key:"_toBinary",value:function(t){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_toBinary",this).call(this,t),t.writeVarString(this._content)}},{key:"_logString",value:function(){return d("ItemString",this,'content:"'+this._content+'"')}},{key:"_splitAt",value:function(t,n){if(0===n)return this;if(n>=this._length)return this._right;var r=new e;return r._content=this._content.slice(n),this._content=this._content.slice(0,n),v(t,this,r,n),r}},{key:"_length",get:function(){return this._content.length}}]),e}(wt),At=function(){function t(e){it(this,t),this.target=e,this.currentTarget=e}return st(t,[{key:"path",get:function(){return this.currentTarget.getPathTo(this.target)}}]),t}(),It=function(t){function e(t,n,r){it(this,e);var o=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o.remote=n,o._transaction=r,o._addedElements=null,o._removedElements=null,o}return ct(e,t),st(e,[{key:"addedElements",get:function(){if(null===this._addedElements){var t=this.target,e=this._transaction,n=new Set;e.newTypes.forEach((function(r){r._parent!==t||e.deletedStructs.has(r)||n.add(r)})),this._addedElements=n}return this._addedElements}},{key:"removedElements",get:function(){if(null===this._removedElements){var t=this.target,e=this._transaction,n=new Set;e.deletedStructs.forEach((function(r){r._parent!==t||e.newTypes.has(r)||n.add(r)})),this._removedElements=n}return this._removedElements}}]),e}(At),Nt=function(t){function e(){return it(this,e),ut(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ct(e,t),st(e,[{key:"_callObserver",value:function(t,e,n){this._callEventHandler(t,new It(this,n,t))}},{key:"get",value:function(t){for(var e=this._start;null!==e;){if(!e._deleted&&e._countable){if(t<e._length)return e.constructor===Ot||e.constructor===Tt?e._content[t]:e;t-=e._length}e=e._right}}},{key:"toArray",value:function(){return this.map((function(t){return t}))}},{key:"toJSON",value:function(){return this.map((function(t){return t instanceof Et?null!==t.toJSON?t.toJSON():t.toString():t}))}},{key:"map",value:function(t){var e=this,n=[];return this.forEach((function(r,o){n.push(t(r,o,e))})),n}},{key:"forEach",value:function(t){for(var e=0,n=this._start;null!==n;){if(!n._deleted&&n._countable)if(n instanceof Et)t(n,e++,this);else for(var r=n._content,o=r.length,i=0;i<o;i++)e++,t(r[i],e,this);n=n._right}}},{key:Symbol.iterator,value:function(){return{next:function(){for(;null!==this._item&&(this._item._deleted||this._item._length<=this._itemElement);)this._item=this._item._right,this._itemElement=0;return null===this._item?{done:!0}:{value:this._item instanceof Et?this._item:this._item._content[this._itemElement++],done:!1}},_item:this._start,_itemElement:0,_count:0}}},{key:"delete",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._y.transact((function(){for(var r=e._start,o=0;null!==r&&n>0;){if(!r._deleted&&r._countable)if(o<=t&&t<o+r._length){var i=t-o;(r=r._splitAt(e._y,i))._splitAt(e._y,n),n-=r._length,r._delete(e._y),o+=i}else o+=r._length;r=r._right}})),n>0)throw new Error("Delete exceeds the range of the YArray")}},{key:"insertAfter",value:function(t,e){var n=this;return this._transact((function(r){var o;o=null===t?n._start:t._right;for(var i=null,s=0;s<e.length;s++){var a=e[s];"function"==typeof a&&(a=new a),a instanceof Et?(null!==i&&(null!==r&&i._integrate(r),t=i,i=null),a._origin=t,a._left=t,a._right=o,a._right_origin=o,a._parent=n,null!==r?a._integrate(r):null===t?n._start=a:t._right=a,t=a):(null===i&&((i=new Ot)._origin=t,i._left=t,i._right=o,i._right_origin=o,i._parent=n,i._content=[]),i._content.push(a))}null!==i&&(null!==r?i._integrate(r):null===i._left&&(n._start=i))})),e}},{key:"insert",value:function(t,e){var n=this;this._transact((function(){for(var r=null,o=n._start,i=0,s=n._y;null!==o;){var a=o._deleted?0:o._length-1;if(i<=t&&t<=i+a){var c=t-i;r=(o=o._splitAt(s,c))._left,i+=c;break}o._deleted||(i+=o._length),r=o,o=o._right}if(t>i)throw new Error("Index exceeds array range!");n.insertAfter(r,e)}))}},{key:"push",value:function(t){for(var e=this._start,n=null;null!==e;)e._deleted||(n=e),e=e._right;this.insertAfter(n,t)}},{key:"_logString",value:function(){return d("YArray",this,"start:"+f(this._start)+'"')}},{key:"length",get:function(){for(var t=0,e=this._start;null!==e;)!e._deleted&&e._countable&&(t+=e._length),e=e._right;return t}}]),e}(Et),Bt=function(t){function e(t,n,r){it(this,e);var o=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o.keysChanged=n,o.remote=r,o}return ct(e,t),e}(At),Ct=function(t){function e(){return it(this,e),ut(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ct(e,t),st(e,[{key:"_callObserver",value:function(t,e,n){this._callEventHandler(t,new Bt(this,e,n))}},{key:"toJSON",value:function(){var t={},e=!0,n=!1,r=void 0;try{for(var o,i=this._map[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s,a=lt(o.value,2),c=a[0],u=a[1];if(!u._deleted)s=u instanceof Et?void 0!==u.toJSON?u.toJSON():u.toString():u._content[0],t[c]=s}}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}return t}},{key:"keys",value:function(){var t=[],e=!0,n=!1,r=void 0;try{for(var o,i=this._map[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=lt(o.value,2),a=s[0];s[1]._deleted||t.push(a)}}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}return t}},{key:"delete",value:function(t){var e=this;this._transact((function(n){var r=e._map.get(t);null!==n&&void 0!==r&&r._delete(n)}))}},{key:"set",value:function(t,e){var n=this;return this._transact((function(r){var o=n._map.get(t)||null;if(null!==o){if(o.constructor===Ot&&!o._deleted&&o._content[0]===e)return e;null!==r&&o._delete(r)}var i=void 0;"function"==typeof e?(i=new e,e=i):e instanceof wt?i=e:(i=new Ot)._content=[e],i._right=o,i._right_origin=o,i._parent=n,i._parentSub=t,null!==r?i._integrate(r):n._map.set(t,i)})),e}},{key:"get",value:function(t){var e=this._map.get(t);if(void 0!==e&&!e._deleted)return e instanceof Et?e:e._content[e._content.length-1]}},{key:"has",value:function(t){var e=this._map.get(t);return void 0!==e&&!e._deleted}},{key:"_logString",value:function(){return d("YMap",this,"mapSize:"+this._map.size)}}]),e}(Et),Dt=function(t){function e(){it(this,e);var t=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.embed=null,t}return ct(e,t),st(e,[{key:"_copy",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_copy",this).call(this,t,n);return r.embed=this.embed,r}},{key:"_fromBinary",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_fromBinary",this).call(this,t,n);return this.embed=JSON.parse(n.readVarString()),r}},{key:"_toBinary",value:function(t){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_toBinary",this).call(this,t),t.writeVarString(JSON.stringify(this.embed))}},{key:"_logString",value:function(){return d("ItemEmbed",this,"embed:"+JSON.stringify(this.embed))}},{key:"_length",get:function(){return 1}}]),e}(wt),Ut=function(t){function e(){it(this,e);var t=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.key=null,t.value=null,t}return ct(e,t),st(e,[{key:"_copy",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_copy",this).call(this,t,n);return r.key=this.key,r.value=this.value,r}},{key:"_fromBinary",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_fromBinary",this).call(this,t,n);return this.key=n.readVarString(),this.value=JSON.parse(n.readVarString()),r}},{key:"_toBinary",value:function(t){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_toBinary",this).call(this,t),t.writeVarString(this.key),t.writeVarString(JSON.stringify(this.value))}},{key:"_logString",value:function(){return d("ItemFormat",this,"key:"+JSON.stringify(this.key)+",value:"+JSON.stringify(this.value))}},{key:"_length",get:function(){return 1}},{key:"_countable",get:function(){return!1}}]),e}(wt),xt=function(t){function e(t,n,r){it(this,e);var o=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return o._delta=null,o}return ct(e,t),st(e,[{key:"delta",get:function(){var t=this;if(null===this._delta){var e=this.target._y;e.transact((function(){var n=t.target._start,r=[],o=t.addedElements,i=t.removedElements;t._delta=r;for(var s=null,a={},c=new Map,u=new Map,l="",h=0,f=0,d=function(){if(null!==s){var t=void 0;switch(s){case"delete":t={delete:f},f=0;break;case"insert":if(t={insert:l},c.size>0){t.attributes={};var e=!0,n=!1,o=void 0;try{for(var i,u=c[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var d=lt(i.value,2),p=d[0],y=d[1];null!==y&&(t.attributes[p]=y)}}catch(t){n=!0,o=t}finally{try{!e&&u.return&&u.return()}finally{if(n)throw o}}}l="";break;case"retain":if(t={retain:h},Object.keys(a).length>0)for(var p in t.attributes={},a)t.attributes[p]=a[p];h=0}r.push(t),s=null}};null!==n;){switch(n.constructor){case Dt:o.has(n)?(d(),s="insert",l=n.embed,d()):i.has(n)?("delete"!==s&&(d(),s="delete"),f+=1):!1===n._deleted&&("retain"!==s&&(d(),s="retain"),h+=1);break;case Tt:o.has(n)?("insert"!==s&&(d(),s="insert"),l+=n._content):i.has(n)?("delete"!==s&&(d(),s="delete"),f+=n._length):!1===n._deleted&&("retain"!==s&&(d(),s="retain"),h+=n._length);break;case Ut:if(o.has(n))(c.get(n.key)||null)!==n.value?("retain"===s&&d(),n.value===(u.get(n.key)||null)?delete a[n.key]:a[n.key]=n.value):n._delete(e);else if(i.has(n)){u.set(n.key,n.value);var p=c.get(n.key)||null;p!==n.value&&("retain"===s&&d(),a[n.key]=p)}else if(!1===n._deleted){u.set(n.key,n.value);var y=a[n.key];void 0!==y&&(y!==n.value?("retain"===s&&d(),null===n.value?a[n.key]=n.value:delete a[n.key]):n._delete(e))}!1===n._deleted&&("insert"===s&&d(),w(c,n))}n=n._right}for(d();t._delta.length>0;){var v=t._delta[t._delta.length-1];if(void 0===v.retain||void 0!==v.attributes)break;t._delta.pop()}}))}return this._delta}}]),e}(It),Pt=function(t){function e(t){it(this,e);var n=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if("string"==typeof t){var r=new Tt;r._parent=n,r._content=t,n._start=r}return n}return ct(e,t),st(e,[{key:"_callObserver",value:function(t,e,n){this._callEventHandler(t,new xt(this,n,t))}},{key:"toString",value:function(){for(var t="",e=this._start;null!==e;)!e._deleted&&e._countable&&(t+=e._content),e=e._right;return t}},{key:"applyDelta",value:function(t){var e=this;this._transact((function(n){for(var r=null,o=e._start,i=new Map,s=0;s<t.length;s++){var a=t[s];if(void 0!==a.insert){var c=O(n,a.insert,e,r,o,i,a.attributes||{}),u=lt(c,2);r=u[0],o=u[1]}else if(void 0!==a.retain){var l=T(n,a.retain,e,r,o,i,a.attributes||{}),h=lt(l,2);r=h[0],o=h[1]}else if(void 0!==a.delete){var f=A(n,a.delete,0,r,o,i),d=lt(f,2);r=d[0],o=d[1]}}}))}},{key:"toDelta",value:function(){function t(){if(r.length>0){var t={},o=!1,i=!0,s=!1,a=void 0;try{for(var c,u=n[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var l=lt(c.value,2),h=l[0],f=l[1];o=!0,t[h]=f}}catch(t){s=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(s)throw a}}var d={insert:r};o&&(d.attributes=t),e.push(d),r=""}}for(var e=[],n=new Map,r="",o=this._start;null!==o;){if(!o._deleted)switch(o.constructor){case Tt:r+=o._content;break;case Ut:t(),w(n,o)}o=o._right}return t(),e}},{key:"insert",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.length<=0||this._transact((function(o){var i=b(n,t),s=lt(i,3),a=s[0],c=s[1],u=s[2];O(o,e,n,a,c,u,r)}))}},{key:"insertEmbed",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.constructor!==Object)throw new Error("Embed must be an Object");this._transact((function(o){var i=b(n,t),s=lt(i,3),a=s[0],c=s[1],u=s[2];O(o,e,n,a,c,u,r)}))}},{key:"delete",value:function(t,e){var n=this;0!==e&&this._transact((function(r){var o=b(n,t),i=lt(o,3),s=i[0],a=i[1],c=i[2];A(r,e,0,s,a,c)}))}},{key:"format",value:function(t,e,n){var r=this;this._transact((function(o){var i=b(r,t),s=lt(i,3),a=s[0],c=s[1],u=s[2];null!==c&&T(o,e,r,a,c,u,n)}))}},{key:"_logString",value:function(){return d("YText",this)}}]),e}(Nt),Rt=function(t){function e(t){it(this,e);var n=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.hookName=null,void 0!==t&&(n.hookName=t),n}return ct(e,t),st(e,[{key:"_copy",value:function(){var t=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_copy",this).call(this);return t.hookName=this.hookName,t}},{key:"toDom",value:function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments[2],n=t[this.hookName],r=void 0;return(r=void 0!==n?n.createDom(this):document.createElement(this.hookName)).setAttribute("data-yjs-hook",this.hookName),x(e,r,this),r}},{key:"_fromBinary",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_fromBinary",this).call(this,t,n);return this.hookName=n.readVarString(),r}},{key:"_toBinary",value:function(t){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_toBinary",this).call(this,t),t.writeVarString(this.hookName)}},{key:"_integrate",value:function(t){if(null===this.hookName)throw new Error("hookName must be defined!");at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_integrate",this).call(this,t)}}]),e}(Ct),jt=function(){function t(e,n){it(this,t),this._filter=n||function(){return!0},this._root=e,this._currentNode=e,this._firstCall=!0}return st(t,[{key:Symbol.iterator,value:function(){return this}},{key:"next",value:function(){var t=this._currentNode;if(this._firstCall&&(this._firstCall=!1,!t._deleted&&this._filter(t)))return{value:t,done:!1};do{if(t._deleted||t.constructor!==Lt._YXmlElement&&t.constructor!==Lt||null===t._start){for(;t!==this._root;){if(null!==t._right){t=t._right;break}t=t._parent}t===this._root&&(t=null)}else t=t._start;if(t===this._root)break}while(null!==t&&(t._deleted||!this._filter(t)));return this._currentNode=t,null===t?{done:!0}:{value:t,done:!1}}}]),t}(),Mt=function(t){function e(t,n,r,o){it(this,e);var i=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i._transaction=o,i.childListChanged=!1,i.attributesChanged=new Set,i.remote=r,n.forEach((function(t){null===t?i.childListChanged=!0:i.attributesChanged.add(t)})),i}return ct(e,t),e}(At),Lt=function(t){function e(){return it(this,e),ut(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ct(e,t),st(e,[{key:"createTreeWalker",value:function(t){return new jt(this,t)}},{key:"querySelector",value:function(t){t=t.toUpperCase();var e=new jt(this,(function(e){return e.nodeName===t})).next();return e.done?null:e.value}},{key:"querySelectorAll",value:function(t){return t=t.toUpperCase(),Array.from(new jt(this,(function(e){return e.nodeName===t})))}},{key:"_callObserver",value:function(t,e,n){this._callEventHandler(t,new Mt(this,e,n,t))}},{key:"toString",value:function(){return this.map((function(t){return t.toString()})).join("")}},{key:"_delete",value:function(t,n,r){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_delete",this).call(this,t,n,r)}},{key:"toDom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=t.createDocumentFragment();return x(n,r,this),this.forEach((function(o){r.insertBefore(o.toDom(t,e,n),null)})),r}},{key:"_logString",value:function(){return d("YXml",this)}}]),e}(Nt),Ht=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"UNDEFINED";it(this,e);var n=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.nodeName=t.toUpperCase(),n}return ct(e,t),st(e,[{key:"_copy",value:function(){var t=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_copy",this).call(this);return t.nodeName=this.nodeName,t}},{key:"_fromBinary",value:function(t,n){var r=at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_fromBinary",this).call(this,t,n);return this.nodeName=n.readVarString(),r}},{key:"_toBinary",value:function(t){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_toBinary",this).call(this,t),t.writeVarString(this.nodeName)}},{key:"_integrate",value:function(t){if(null===this.nodeName)throw new Error("nodeName must be defined!");at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_integrate",this).call(this,t)}},{key:"toString",value:function(){var t=this.getAttributes(),n=[],r=[];for(var o in t)r.push(o);r.sort();for(var i=r.length,s=0;s<i;s++){var a=r[s];n.push(a+'="'+t[a]+'"')}var c=this.nodeName.toLocaleLowerCase();return"<"+c+(n.length>0?" "+n.join(" "):"")+">"+at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"toString",this).call(this)+"</"+c+">"}},{key:"removeAttribute",value:function(t){return Ct.prototype.delete.call(this,t)}},{key:"setAttribute",value:function(t,e){return Ct.prototype.set.call(this,t,e)}},{key:"getAttribute",value:function(t){return Ct.prototype.get.call(this,t)}},{key:"getAttributes",value:function(){var t={},e=!0,n=!1,r=void 0;try{for(var o,i=this._map[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=lt(o.value,2),a=s[0],c=s[1];c._deleted||(t[a]=c._content[0])}}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}return t}},{key:"toDom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=t.createElement(this.nodeName),o=this.getAttributes();for(var i in o)r.setAttribute(i,o[i]);return this.forEach((function(o){r.appendChild(o.toDom(t,e,n))})),x(n,r,this),r}}]),e}(Lt);Lt._YXmlElement=Ht;var Vt=function(t){function e(){return it(this,e),ut(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return ct(e,t),st(e,[{key:"toDom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments[2],n=t.createTextNode(this.toString());return x(e,n,this),n}},{key:"_delete",value:function(t,n,r){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_delete",this).call(this,t,n,r)}}]),e}(Pt),qt=new Map,Wt=new Map;M(0,Ot),M(1,Tt),M(10,Ut),M(11,Dt),M(2,bt),M(3,Nt),M(4,Ct),M(5,Pt),M(6,Lt),M(7,Ht),M(8,Vt),M(9,Rt),M(12,_t);var Yt=16777215,zt=function(){function t(e,n){it(this,t),this.user=Yt,this.name=e,this.type=H(n)}return st(t,[{key:"equals",value:function(t){return null!==t&&t.user===this.user&&t.name===this.name&&t.type===this.type}},{key:"lessThan",value:function(e){return e.constructor!==t||this.user<e.user||this.user===e.user&&(this.name<e.name||this.name===e.name&&this.type<e.type)}}]),t}(),Jt=function(t){function e(t){it(this,e);var n=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.y=t,n}return ct(e,t),st(e,[{key:"logTable",value:function(){var t=[];this.iterate(null,null,(function(e){e.constructor===_t?t.push({id:f(e),content:e._length,deleted:"GC"}):t.push({id:f(e),origin:f(null===e._origin?null:e._origin._lastId),left:f(null===e._left?null:e._left._lastId),right:f(e._right),right_origin:f(e._right_origin),parent:f(e._parent),parentSub:e._parentSub,deleted:e._deleted,content:JSON.stringify(e._content)})})),console.table(t)}},{key:"get",value:function(t){var e=this.find(t);if(null===e&&t instanceof zt){var n=L(t.type),r=this.y;(e=new n)._id=t,e._parent=r,r.transact((function(){e._integrate(r)})),this.put(e)}return e}},{key:"getItem",value:function(t){var e=this.findWithUpperBound(t);if(null===e)return null;var n=e._id;return t.user===n.user&&t.clock<n.clock+e._length?e:null}},{key:"getItemCleanStart",value:function(t){var e=this.getItem(t);if(null===e||1===e._length)return e;var n=e._id;return n.clock===t.clock?e:e._splitAt(this.y,t.clock-n.clock)}},{key:"getItemCleanEnd",value:function(t){var e=this.getItem(t);if(null===e||1===e._length)return e;var n=e._id;return n.clock+e._length-1===t.clock?e:(e._splitAt(this.y,t.clock-n.clock+1),e)}}]),e}(ft),Xt=function(){function t(e){it(this,t),this.y=e,this.state=new Map}return st(t,[{key:"logTable",value:function(){var t=[],e=!0,n=!1,r=void 0;try{for(var o,i=this.state[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=lt(o.value,2),a=s[0],c=s[1];t.push({user:a,state:c})}}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}console.table(t)}},{key:"getNextID",value:function(t){var e=this.y.userID,n=this.getState(e);return this.setState(e,n+t),new dt(e,n)}},{key:"updateRemoteState",value:function(t){for(var e=t._id.user,n=this.state.get(e);null!==t&&t._id.clock===n;)n+=t._length,t=this.y.os.get(new dt(e,n));this.state.set(e,n)}},{key:"getState",value:function(t){var e=this.state.get(t);return null==e?0:e}},{key:"setState",value:function(t,e){var n=this.y._transaction.beforeState;n.has(t)||n.set(t,this.getState(t)),this.state.set(t,e)}}]),t}(),Ft=function(){function t(){it(this,t),this._eventListener=new Map,this._stateListener=new Map}return st(t,[{key:"_getListener",value:function(t){var e=this._eventListener.get(t);return void 0===e&&(e={once:new Set,on:new Set},this._eventListener.set(t,e)),e}},{key:"once",value:function(t,e){this._getListener(t).once.add(e)}},{key:"on",value:function(t,e){this._getListener(t).on.add(e)}},{key:"_initStateListener",value:function(t){var e=this._stateListener.get(t);return void 0===e&&((e={}).promise=new Promise((function(t){e.resolve=t})),this._stateListener.set(t,e)),e}},{key:"when",value:function(t){return this._initStateListener(t).promise}},{key:"off",value:function(t,e){if(null==t||null==e)throw new Error("You must specify event name and function!");var n=this._eventListener.get(t);void 0!==n&&(n.on.delete(e),n.once.delete(e))}},{key:"emit",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this._initStateListener(t).resolve();var o=this._eventListener.get(t);void 0!==o?(o.on.forEach((function(t){return t.apply(null,n)})),o.once.forEach((function(t){return t.apply(null,n)})),o.once=new Set):"error"===t&&console.error(n[0])}},{key:"destroy",value:function(){this._eventListener=null}}]),t}(),Kt=function(){function t(e,n){it(this,t),this.type=e,this.target=n,this._mutualExclude=W()}return st(t,[{key:"destroy",value:function(){this.type=null,this.target=null}}]),t}(),Gt=null,$t="undefined"!=typeof getSelection?function(t){var e=getSelection(),n=e.baseNode,r=e.baseOffset,o=e.extentNode,i=e.extentOffset,s=t.domToType.get(n),a=t.domToType.get(o);return void 0!==s&&void 0!==a?{from:V(s,r),to:V(a,i)}:null}:function(){return null},Zt=function(t){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};it(this,e);var o=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));o.opts=r,r.document=r.document||document,r.hooks=r.hooks||{},o.scrollingElement=r.scrollingElement||null,o.domToType=new Map,o.typeToDom=new Map,o.filter=r.filter||N,n.innerHTML="",t.forEach((function(t){n.insertBefore(t.toDom(r.document,r.hooks,o),null)})),o._typeObserver=Y.bind(o),o._domObserver=function(t){X.call(o,t,r.document)},t.observeDeep(o._typeObserver),o._mutationObserver=new MutationObserver(o._domObserver),o._mutationObserver.observe(n,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),o._currentSel=null,document.addEventListener("selectionchange",(function(){o._currentSel=$t(o)}));var i=t._y;return o.y=i,o._beforeTransactionHandler=function(t,e,n){o._domObserver(o._mutationObserver.takeRecords()),o._mutualExclude((function(){!function(t,e){e&&(Gt=$t(t))}(o,n)}))},i.on("beforeTransaction",o._beforeTransactionHandler),o._afterTransactionHandler=function(t,e,n){o._mutualExclude((function(){!function(t,e){null!==Gt&&e&&t.restoreSelection(Gt)}(o,n)})),e.deletedStructs.forEach((function(t){var e=o.typeToDom.get(t);void 0!==e&&U(o,e,t)}))},i.on("afterTransaction",o._afterTransactionHandler),o._beforeObserverCallsHandler=function(t,e){e.changedTypes.forEach((function(e,n){(e.size>1||1===e.size&&!1===e.has(null))&&B(t,o,n)})),e.newTypes.forEach((function(e){B(t,o,e)}))},i.on("beforeObserverCalls",o._beforeObserverCallsHandler),x(o,n,t),o}return ct(e,t),st(e,[{key:"setFilter",value:function(t){this.filter=t}},{key:"_getUndoStackInfo",value:function(){return this.getSelection()}},{key:"_restoreUndoStackInfo",value:function(t){this.restoreSelection(t)}},{key:"getSelection",value:function(){return this._currentSel}},{key:"restoreSelection",value:function(t){if(null!==t){var e=t.to,n=t.from,r=!1,o=getSelection(),i=o.baseNode,s=o.baseOffset,a=o.extentNode,c=o.extentOffset;if(null!==n){var u=q(this.y,n);if(null!==u){var l=this.typeToDom.get(u.type),h=u.offset;l===i&&h===s||(i=l,s=h,r=!0)}}if(null!==e){var f=q(this.y,e);if(null!==f){var d=this.typeToDom.get(f.type),p=f.offset;d===a&&p===c||(a=d,c=p,r=!0)}}r&&o.setBaseAndExtent(i,s,a,c)}}},{key:"destroy",value:function(){this.domToType=null,this.typeToDom=null,this.type.unobserveDeep(this._typeObserver),this._mutationObserver.disconnect();var t=this.type._y;t.off("beforeTransaction",this._beforeTransactionHandler),t.off("beforeObserverCalls",this._beforeObserverCallsHandler),t.off("afterTransaction",this._afterTransactionHandler),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}}]),e}(Kt),Qt=function(t){function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};it(this,e);var i=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i.gcEnabled=o.gc||!1,i.room=t,null!=n&&(n.connector.room=t),i._contentReady=!1,i._opts=n,"number"!=typeof n.userID?i.userID=function(){if("undefined"!=typeof crypto&&null!=crypto.getRandomValue){var t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]}if("undefined"!=typeof crypto&&null!=crypto.randomBytes){var e=crypto.randomBytes(4);return new Uint32Array(e.buffer)[0]}return Math.ceil(4294967295*Math.random())}():i.userID=n.userID,i.share={},i.ds=new yt(i),i.os=new Jt(i),i.ss=new Xt(i),i._missingStructs=new Map,i._readyToIntegrate=[],i._transaction=null,i.connector=null,i.connected=!1;var s=function(){null!=n&&(i.connector=new e[n.connector.name](i,n.connector),i.connected=!0,i.emit("connectorReady"))};return i.persistence=null,null!=r?(i.persistence=r,r._init(i).then(s)):s(),i._parent=null,i._hasUndoManager=!1,i}return ct(e,t),st(e,[{key:"_setContentReady",value:function(){this._contentReady||(this._contentReady=!0,this.emit("content"))}},{key:"whenContentReady",value:function(){var t=this;return this._contentReady?Promise.resolve():new Promise((function(e){t.once("content",e)}))}},{key:"_beforeChange",value:function(){}},{key:"transact",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null===this._transaction;n&&(this._transaction=new kt(this),this.emit("beforeTransaction",this,this._transaction,e));try{t(this)}catch(t){console.error(t)}if(n){this.emit("beforeObserverCalls",this,this._transaction,e);var r=this._transaction;this._transaction=null,r.changedTypes.forEach((function(t,n){n._deleted||n._callObserver(r,t,e)})),r.changedParentTypes.forEach((function(t,e){e._deleted||((t=t.filter((function(t){return!t.target._deleted}))).forEach((function(t){t.currentTarget=e})),e._deepEventHandler.callEventListeners(r,t))})),this.emit("afterTransaction",this,r,e)}}},{key:"define",value:function(t,e){var n=new zt(t,e),r=this.os.get(n);if(void 0===this.share[t])this.share[t]=r;else if(this.share[t]!==r)throw new Error("Type is already defined with a different constructor");return r}},{key:"get",value:function(t){return this.share[t]}},{key:"disconnect",value:function(){return this.connected?(this.connected=!1,this.connector.disconnect()):Promise.resolve()}},{key:"reconnect",value:function(){return this.connected?Promise.resolve():(this.connected=!0,this.connector.reconnect())}},{key:"destroy",value:function(){at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.share=null,null!=this.connector&&(null!=this.connector.destroy?this.connector.destroy():this.connector.disconnect()),null!==this.persistence&&(this.persistence.deinit(this),this.persistence=null),this.os=null,this.ds=null,this.ss=null}},{key:"_start",get:function(){return null},set:function(t){return null}}]),e}(Ft);Qt.extend=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("function"!=typeof e)throw new Error("Expected a function!");e(Qt)}};var te=function t(e,n,r){var o=this;it(this,t),this.created=new Date;var i=n.beforeState;i.has(e.userID)?(this.toState=new dt(e.userID,e.ss.getState(e.userID)-1),this.fromState=new dt(e.userID,i.get(e.userID))):(this.toState=null,this.fromState=null),this.deletedStructs=new Set,n.deletedStructs.forEach((function(t){o.deletedStructs.add({from:t._id,len:t._length})})),this.bindingInfos=r},ee=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};it(this,t),this.options=r,this._bindings=new Set(r.bindings),r.captureTimeout=null==r.captureTimeout?500:r.captureTimeout,this._undoBuffer=[],this._redoBuffer=[],this._scope=e,this._undoing=!1,this._redoing=!1,this._lastTransactionWasUndo=!1;var o=e._y;this.y=o,o._hasUndoManager=!0;var i=void 0;o.on("beforeTransaction",(function(t,e,r){r||(i=new Map,n._bindings.forEach((function(t){i.set(t,t._getUndoStackInfo())})))})),o.on("afterTransaction",(function(t,o,s){if(!s&&o.changedParentTypes.has(e)){var a=new te(t,o,i);if(n._undoing)n._lastTransactionWasUndo=!0,n._redoBuffer.push(a);else{var c=n._undoBuffer.length>0?n._undoBuffer[n._undoBuffer.length-1]:null;!1===n._redoing&&!1===n._lastTransactionWasUndo&&null!==c&&(r.captureTimeout<0||a.created-c.created<=r.captureTimeout)?(c.created=a.created,null!==a.toState&&(c.toState=a.toState,null===c.fromState&&(c.fromState=a.fromState)),a.deletedStructs.forEach(c.deletedStructs.add,c.deletedStructs)):(n._lastTransactionWasUndo=!1,n._undoBuffer.push(a)),n._redoing||(n._redoBuffer=[])}}}))}return st(t,[{key:"flushChanges",value:function(){this._lastTransactionWasUndo=!0}},{key:"undo",value:function(){this._undoing=!0;var t=F(this.y,this._scope,this._undoBuffer);return this._undoing=!1,t}},{key:"redo",value:function(){this._redoing=!0;var t=F(this.y,this._scope,this._redoBuffer);return this._redoing=!1,t}}]),t}(),ne=1e3,re=60*ne,oe=60*re,ie=24*oe,se=365.25*ie,ae=function(t,e){e=e||{};var n=void 0===t?"undefined":ot(t);if("string"===n&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*se;case"days":case"day":case"d":return n*ie;case"hours":case"hour":case"hrs":case"hr":case"h":return n*oe;case"minutes":case"minute":case"mins":case"min":case"m":return n*re;case"seconds":case"second":case"secs":case"sec":case"s":return n*ne;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(t);if("number"===n&&!1===isNaN(t))return e.long?function(t){return G(t,ie,"day")||G(t,oe,"hour")||G(t,re,"minute")||G(t,ne,"second")||t+" ms"}(t):function(t){return t>=ie?Math.round(t/ie)+"d":t>=oe?Math.round(t/oe)+"h":t>=re?Math.round(t/re)+"m":t>=ne?Math.round(t/ne)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))},ce=Object.freeze({default:ae,__moduleExports:ae}),ue=ce&&ae||ce,le=K((function(t,e){function n(t){function n(){if(n.enabled){var t=n,o=+new Date,i=o-(r||o);t.diff=i,t.prev=r,t.curr=o,r=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var o=e.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(t,i),s.splice(c,1),c--}return n})),e.formatArgs.call(t,s),(n.log||e.log||console.log.bind(console)).apply(t,s)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),"function"==typeof e.init&&e.init(n),n}var r;(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){e.save(t),e.names=[],e.skips=[];for(var n=("string"==typeof t?t:"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&("-"===(t=n[o].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=ue,e.names=[],e.skips=[],e.formatters={}})),he=le.coerce,fe=le.disable,de=le.enable,pe=le.enabled,ye=le.humanize,ve=le.names,_e=le.skips,ge=le.formatters,me=Object.freeze({default:le,__moduleExports:le,coerce:he,disable:fe,enable:de,enabled:pe,humanize:ye,names:ve,skips:_e,formatters:ge}),be=me&&le||me,ke=K((function(t,e){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==n&&"env"in n&&(t=Object({NODE_ENV:"production",CE_VERSION:"91.0.11335",TEST:!1,WALLABY:!1,SKIP_SLOW_TESTS:void 0,EDITOR:"peso",TEST_CATEGORIES:[]}).DEBUG),t}(e=t.exports=be).log=function(){return"object"===("undefined"==typeof console?"undefined":ot(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var o=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))})),t.splice(i,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(r())})),we=(ke.log,ke.formatArgs,ke.save,ke.load,ke.useColors,ke.storage,ke.colors,function(){function t(e,n){if(it(this,t),this.y=e,this.opts=n,null==n.role||"master"===n.role)this.role="master";else{if("slave"!==n.role)throw new Error("Role must be either 'master' or 'slave'!");this.role="slave"}this.log=ke("y:connector"),this.logMessage=ke("y:connector-message"),this._forwardAppliedStructs=n.forwardAppliedOperations||!1,this.role=n.role,this.connections=new Map,this.isSynced=!1,this.userEventListeners=[],this.whenSyncedListeners=[],this.currentSyncTarget=null,this.debug=!0===n.debug,this.broadcastBuffer=new mt,this.broadcastBufferSize=0,this.protocolVersion=11,this.authInfo=n.auth||null,this.checkAuth=n.checkAuth||function(){return Promise.resolve("write")},null==n.maxBufferLength?this.maxBufferLength=-1:this.maxBufferLength=n.maxBufferLength}return st(t,[{key:"reconnect",value:function(){this.log("reconnecting..")}},{key:"disconnect",value:function(){return this.log("discronnecting.."),this.connections=new Map,this.isSynced=!1,this.currentSyncTarget=null,this.whenSyncedListeners=[],Promise.resolve()}},{key:"onUserEvent",value:function(t){this.userEventListeners.push(t)}},{key:"removeUserEventListener",value:function(t){this.userEventListeners=this.userEventListeners.filter((function(e){return t!==e}))}},{key:"userLeft",value:function(t){if(this.connections.has(t)){this.log("%s: User left %s",this.y.userID,t),this.connections.delete(t),this._setSyncedWith(null);var e=!0,n=!1,r=void 0;try{for(var o,i=this.userEventListeners[Symbol.iterator]();!(e=(o=i.next()).done);e=!0)(0,o.value)({action:"userLeft",user:t})}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}}}},{key:"userJoined",value:function(t,e,n){if(null==e)throw new Error("You must specify the role of the joined user!");if(this.connections.has(t))throw new Error("This user already joined!");this.log("%s: User joined %s",this.y.userID,t),this.connections.set(t,{uid:t,isSynced:!1,role:e,processAfterAuth:[],processAfterSync:[],auth:n||null,receivedSyncStep2:!1});var r={};r.promise=new Promise((function(t){r.resolve=t})),this.connections.get(t).syncStep2=r;var o=!0,i=!1,s=void 0;try{for(var a,c=this.userEventListeners[Symbol.iterator]();!(o=(a=c.next()).done);o=!0)(0,a.value)({action:"userJoined",user:t,role:e})}catch(t){i=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}this._syncWithUser(t)}},{key:"whenSynced",value:function(t){this.isSynced?t():this.whenSyncedListeners.push(t)}},{key:"_syncWithUser",value:function(t){"slave"!==this.role&&c(this,t)}},{key:"_fireIsSyncedListeners",value:function(){if(!this.isSynced){this.isSynced=!0;var t=!0,e=!1,n=void 0;try{for(var r,o=this.whenSyncedListeners[Symbol.iterator]();!(t=(r=o.next()).done);t=!0)(0,r.value)()}catch(t){e=!0,n=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw n}}this.whenSyncedListeners=[],this.y._setContentReady(),this.y.emit("synced")}}},{key:"send",value:function(t,e){var n=this.y;if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Error("Expected Message to be an ArrayBuffer or Uint8Array - don't use this method to send custom messages");this.log("User%s to User%s: Send '%y'",n.userID,t,e),this.logMessage("User%s to User%s: Send %Y",n.userID,t,[n,e])}},{key:"broadcast",value:function(t){var e=this.y;if(!(t instanceof ArrayBuffer||t instanceof Uint8Array))throw new Error("Expected Message to be an ArrayBuffer or Uint8Array - don't use this method to send custom messages");this.log("User%s: Broadcast '%y'",e.userID,t),this.logMessage("User%s: Broadcast: %Y",e.userID,[e,t])}},{key:"broadcastStruct",value:function(t){var e=this,n=0===this.broadcastBuffer.length;if(n&&(this.broadcastBuffer.writeVarString(this.y.room),this.broadcastBuffer.writeVarString("update"),this.broadcastBufferSize=0,this.broadcastBufferSizePos=this.broadcastBuffer.pos,this.broadcastBuffer.writeUint32(0)),this.broadcastBufferSize++,t._toBinary(this.broadcastBuffer),this.maxBufferLength>0&&this.broadcastBuffer.length>this.maxBufferLength){var r=this.broadcastBuffer;r.setUint32(this.broadcastBufferSizePos,this.broadcastBufferSize),this.broadcastBuffer=new mt,this.whenRemoteResponsive().then((function(){e.broadcast(r.createBuffer())}))}else n&&setTimeout((function(){if(e.broadcastBuffer.length>0){var t=e.broadcastBuffer;t.setUint32(e.broadcastBufferSizePos,e.broadcastBufferSize),e.broadcast(t.createBuffer()),e.broadcastBuffer=new mt}}),0)}},{key:"whenRemoteResponsive",value:function(){return new Promise((function(t){setTimeout(t,100)}))}},{key:"receiveMessage",value:function(t,e,n){var r=this,o=this.y,i=o.userID;if(n=n||!1,!(e instanceof ArrayBuffer||e instanceof Uint8Array))return Promise.reject(new Error("Expected Message to be an ArrayBuffer or Uint8Array!"));if(t===i)return Promise.resolve();var s=new vt(e),a=new mt,c=s.readVarString();a.writeVarString(c);var u=s.readVarString(),l=this.connections.get(t);if(this.log("User%s from User%s: Receive '%s'",i,t,u),this.logMessage("User%s from User%s: Receive %Y",i,t,[o,e]),null==l&&!n)throw new Error("Received message from unknown peer!");if("sync step 1"===u||"sync step 2"===u){var h=s.readVarUint();if(null==l.auth)return l.processAfterAuth.push([u,l,s,a,t]),this.checkAuth(h,o,t).then((function(t){null==l.auth&&(l.auth=t,o.emit("userAuthenticated",{user:l.uid,auth:t}));var e=l.processAfterAuth;l.processAfterAuth=[],e.forEach((function(t){return r.computeMessage(t[0],t[1],t[2],t[3],t[4])}))}))}!n&&null==l.auth||"update"===u&&!l.isSynced?l.processAfterSync.push([u,l,s,a,t,!1]):this.computeMessage(u,l,s,a,t,n)}},{key:"computeMessage",value:function(t,e,n,r,o,s){if("sync step 1"!==t||"write"!==e.auth&&"read"!==e.auth){var a=this.y;a.transact((function(){if("sync step 2"===t&&"write"===e.auth)h(n,0,a,0,o);else{if("update"!==t||!s&&"write"!==e.auth)throw new Error("Unable to receive message");i(a,n)}}),!0)}else l(n,r,this.y,e,o)}},{key:"_setSyncedWith",value:function(t){var e=this;if(null!=t){var n=this.connections.get(t);n.isSynced=!0;var r=n.processAfterSync;n.processAfterSync=[],r.forEach((function(t){e.computeMessage(t[0],t[1],t[2],t[3],t[4])}))}var o=Array.from(this.connections.values());o.length>0&&o.every((function(t){return t.isSynced}))&&this._fireIsSyncedListeners()}}]),t}()),Se=function(){function t(e){it(this,t),this.opts=e,this.ys=new Map}return st(t,[{key:"_init",value:function(t){var e=this,n=this.ys.get(t);return void 0===n?((n=Q()).mutualExclude=W(),this.ys.set(t,n),this.init(t).then((function(){return t.on("afterTransaction",(function(t,n){var r=e.ys.get(t);if(r.len>0){r.buffer.setUint32(0,r.len),e.saveUpdate(t,r.buffer.createBuffer(),n);var o=Q();for(var i in o)r[i]=o[i]}})),e.retrieve(t)})).then((function(){return Promise.resolve(n)}))):Promise.resolve(n)}},{key:"deinit",value:function(t){this.ys.delete(t),t.persistence=null}},{key:"destroy",value:function(){this.ys=null}},{key:"removePersistedData",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.ys.forEach((function(r,o){o.room===t&&(n?o.destroy():e.deinit(o))}))}},{key:"saveUpdate",value:function(t){}},{key:"saveStruct",value:function(t,e){var n=this.ys.get(t);void 0!==n&&n.mutualExclude((function(){e._toBinary(n.buffer),n.len++}))}},{key:"retrieve",value:function(t,e,n){var r=this.ys.get(t);void 0!==r&&r.mutualExclude((function(){t.transact((function(){if(null!=e&&$(t,new vt(new Uint8Array(e))),null!=n)for(var r=0;r<n.length;r++)i(t,new vt(new Uint8Array(n[r])))})),t.emit("persistenceReady")}))}},{key:"persist",value:function(t){return Z(t).createBuffer()}}]),t}(),Ee=function(t){function e(t,n){it(this,e);var r=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return n.value=t.toString(),r._typeObserver=tt.bind(r),r._domObserver=et.bind(r),t.observe(r._typeObserver),n.addEventListener("input",r._domObserver),r}return ct(e,t),st(e,[{key:"destroy",value:function(){this.type.unobserve(this._typeObserver),this.target.unobserve(this._domObserver),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}}]),e}(Kt),Oe=function(t){function e(t,n){it(this,e);var r=ut(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return n.setContents(t.toDelta(),"yjs"),r._typeObserver=nt.bind(r),r._quillObserver=rt.bind(r),t.observe(r._typeObserver),n.on("text-change",r._quillObserver),r}return ct(e,t),st(e,[{key:"destroy",value:function(){this.type.unobserve(this._typeObserver),this.target.off("text-change",this._quillObserver),at(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}}]),e}(Kt);return Qt.AbstractConnector=we,Qt.AbstractPersistence=Se,Qt.Array=Nt,Qt.Map=Ct,Qt.Text=Pt,Qt.XmlElement=Ht,Qt.XmlFragment=Lt,Qt.XmlText=Vt,Qt.XmlHook=Rt,Qt.TextareaBinding=Ee,Qt.QuillBinding=Oe,Qt.DomBinding=Zt,Zt.domToType=C,Zt.domsToTypes=P,Zt.switchAssociation=function(t,e,n){if(void 0!==t){var r=t.domToType.get(e);void 0!==r&&(U(t,e,r),x(t,n,r))}},Qt.utils={BinaryDecoder:vt,UndoManager:ee,getRelativePosition:V,fromRelativePosition:q,registerStruct:M,integrateRemoteStructs:i,toBinary:Z,fromBinary:$},Qt.debug=ke,ke.formatters.Y=function(t){var e=lt(t,2),n=e[0],r=e[1],i=new vt(r);i.readVarString();var s=i.readVarString(),a=[];return a.push("\n === "+s+" ==="),"update"===s?o(n,i,a):"sync step 1"===s?function(t,e,n){var r=e.readVarString(),o=e.readVarUint();n.push('  - auth: "'+r+'"'),n.push("  - protocolVersion: "+o);for(var i=[],s=e.readUint32(),a=0;a<s;a++){var c=e.readVarUint(),u=e.readVarUint();i.push("("+c+":"+u+")")}n.push("  == SS: "+i.join(","))}(0,i,a):"sync step 2"===s?function(t,e,n){n.push("     - auth: "+e.readVarString()),n.push("  == OS:"),o(t,e,n),n.push("  == DS:");for(var r=e.readUint32(),i=0;i<r;i++){var s=e.readVarUint();n.push("    User: "+s+": ");for(var a=e.readUint32(),c=0;c<a;c++){var u=e.readVarUint(),l=e.readVarUint(),h=1===e.readUint8();n.push("["+u+", "+l+", "+h+"]")}}}(n,i,a):a.push("-- Unknown message type - probably an encoding issue!!!"),a.join("\n")},ke.formatters.y=function(t){var e=new vt(t);return e.readVarString(),e.readVarString()},Qt}()}).call(this,n(86).Buffer,n(139))},1840:function(t,e,n){
/**
 * y-indexeddb - IndexedDB database adapter for Yjs
 * @version v9.0.0-6
 * @license MIT
 */
t.exports=function(){"use strict";function t(t){return new Promise((function(e,n){t.onerror=function(t){n(new Error(t.target.error))},t.onblocked=function(){location.reload()},t.onsuccess=function(t){e(t.target.result)}}))}function e(e){var u=function(u){function l(t){n(this,l);var e=s(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,t));return window.addEventListener("unload",(function(){e.ys.forEach((function(t,e){null!==t.db?t.db.close():t._db.then((function(t){return t.close()}))}))})),e}return i(l,u),r(l,[{key:"init",value:function(t){var n=this.ys.get(t),r=t.room;n.db=null;var o=function(t){return new Promise((function(e,n){var r=indexedDB.open(t);window.r1=r,r.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains("model")&&(e.deleteObjectStore("updates"),e.deleteObjectStore("model"),e.deleteObjectStore("custom")),e.createObjectStore("updates",{autoIncrement:!0}),e.createObjectStore("model"),e.createObjectStore("custom")},r.onerror=function(t){n(new Error(t.target.error))},r.onblocked=function(){location.reload()},r.onsuccess=function(t){var n=t.target.result;n.onversionchange=function(){n.close()},e(n)}}))}(r);return o.then((function(t){n.db=t})),"undefined"!=typeof BroadcastChannel?(n.channel=new BroadcastChannel("__yjs__"+r),n.channel.addEventListener("message",(function(r){n.mutualExclude((function(){t.transact((function(){e.utils.integrateRemoteStructs(t,new e.utils.BinaryDecoder(r.data))}),!0)}))}))):n.channel=null,o}},{key:"deinit",value:function(t){this.ys.get(t).db.close(),o(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"deinit",this).call(this,t)}},{key:"set",value:function(e,n,r){return t(this.ys.get(e).db.transaction(["custom"],"readwrite").objectStore("custom").put(r,n))}},{key:"get",value:function(e,n){return t(this.ys.get(e).db.transaction(["custom"],"readwrite").objectStore("custom").get(n))}},{key:"removePersistedData",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return o(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"removePersistedData",this).call(this,e,n),t(indexedDB.deleteDatabase(e))}},{key:"saveUpdate",value:function(e,n){var r=this,o=this.ys.get(e);null!==o.channel&&o.channel.postMessage(n);var i=o.db.transaction(["updates"],"readwrite").objectStore("updates");i.put(n),t(i.count()).then((function(t){t>=c&&r.persist(e)}))}},{key:"saveStruct",value:function(t,e){o(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"saveStruct",this).call(this,t,e)}},{key:"retrieve",value:function(e){var n=this,r=this.ys.get(e).db.transaction(["updates","model"],"readonly"),i=r.objectStore("model"),s=r.objectStore("updates");return Promise.all([t(i.get(0)),t(s.getAll())]).then((function(t){var r=a(t,2),i=r[0],s=r[1];o(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"retrieve",n).call(n,e,i,s)}))}},{key:"persist",value:function(n){var r=this,o=this.ys.get(n).db.transaction(["updates","model"],"readwrite"),i=o.objectStore("updates");return t(i.getAll()).then((function(t){e.AbstractPersistence.prototype.retrieve.call(r,n,null,t);var s=e.AbstractPersistence.prototype.persist.call(r,n);t.length>0&&(o.objectStore("model").put(s,0),i.clear())}))}}]),l}(e.AbstractPersistence);return e.IndexedDB=u,u}var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=500;return"undefined"!=typeof Y&&e(Y),e}()},1841:function(t,e,n){(function(e,n){
/**
 * en-y-websockets-client - Websockets connector for Yjs (browser/node client)
 * @version v10.0.44
 * @license MIT
 */
t.exports=function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}function r(t){return o(t,j,"day")||o(t,R,"hour")||o(t,P,"minute")||o(t,x,"second")||t+" ms"}function o(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}function i(){}function s(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var o=new Uint8Array(n.byteLength);o.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=o.buffer}t[e]=r}}}function a(t,e){e=e||{};var n=new dt;s(t);for(var r=0;r<t.length;r++)n.append(t[r]);return e.type?n.getBlob(e.type):n.getBlob()}function c(t,e){return s(t),new Blob(t,e||{})}function u(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}function l(t){var e="";do{e=St[t%Et]+e,t=Math.floor(t/Et)}while(t>0);return e}function h(){var t=l(+new Date);return t!==bt?(Tt=0,bt=t):t+"."+l(Tt++)}function f(t){var e=t&&t.forceBase64;Ct&&!e||(this.supportsBinary=!1),mt.call(this,t)}function d(){}function p(t){if(Bt.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,E.location){var e="https:"===location.protocol,n=location.port;n||(n=e?443:80),this.xd=t.hostname!==E.location.hostname||n!==t.port,this.xs=t.secure!==e}}function y(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function v(){for(var t in y.requests)y.requests.hasOwnProperty(t)&&y.requests[t].abort()}function _(){}function g(t){Bt.call(this,t),this.query=this.query||{},Pt||(E.___eio||(E.___eio=[]),Pt=E.___eio),this.index=Pt.length;var e=this;Pt.push((function(t){e.onData(t)})),this.query.j=this.index,E.document&&E.addEventListener&&E.addEventListener("beforeunload",(function(){e.script&&(e.script.onerror=_)}),!1)}function m(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=Yt&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(zt=Lt),mt.call(this,t)}function b(t,e){if(!(this instanceof b))return new b(t,e);e=e||{},t&&"object"===(void 0===t?"undefined":I(t))&&(e=t,t=null),t?(t=A(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=A(e.host).host),this.secure=null!=e.secure?e.secure:E.location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||(E.location?location.hostname:"localhost"),this.port=e.port||(E.location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=kt.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode;var n="object"===I(E)&&E;n.global===n&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function k(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}function w(t,e){if(!(this instanceof w))return new w(t,e);t&&"object"===(void 0===t?"undefined":I(t))&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new fe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||it;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}function S(t){var e=function(e){function n(t,e){if(N(this,n),void 0===e)throw new Error("Options must not be undefined!");e.role="slave",e.preferUntransformed=!0,!1!==e.initSync&&(e.initSync=!0);var r=U(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));if(r._sentSync=!1,e.options=e.options||{},r.options=e,null==e.url)throw new Error("No rte url provided!");r.serverVersion=null,r.lastUpdateMarker=-1,r.clientID=r.y.userID,r.rteEvents=[],r._businessID=null,r._noteContentInfo=new Oe(r.y),r._syncMetadata={},r.options.newNote&&(r._syncMetadata.updateSequenceNumber=0,r._syncMetadata.contentDirty=!0),r.handshakeTimeout=null,r._handshakeTimeoutHandler=r._handshakeTimeoutHandler.bind(r);var o=function(){return null};return r.errorHandler=e.errorHandler,r.socketHandlers={connect:e.socketHandlers.connect||o,connectError:e.socketHandlers.connectError||o,reconnect:e.socketHandlers.reconnect||o,reconnectAttempt:e.socketHandlers.reconnectAttempt||o,reconnectError:e.socketHandlers.reconnectError||o,disconnect:e.socketHandlers.disconnect||o},r.utilities={resetYjsModel:e.utilities.resetYjsModel||o,noteSavedNotification:e.utilities.noteSavedNotification||o,errorHandler:e.utilities.errorHandler||o,permissionsHandler:e.utilities.permissionsHandler||o,userConnectionsHandler:e.utilities.userConnectionsHandler||o},r._tornDown=!1,r._setupYJSEventsHandlers(),r._reconnectTimeout=Fe.RECONNECT_WATCHDOG_TIMEOUT,r._reconnectInterval=null,r._previousConnectionAttemptTime=0,r._setupReconnectWatchdog(),r.createWebSocketIO(),r}return D(n,e),B(n,[{key:"createWebSocketIO",value:function(){var e=this,n=new Date;if(this._previousConnectionAttemptTime+Fe.TIME_TO_COMPLETE_PREVIOUS_CONNECTION_ESTABLISHMENT_BY>n)ke.debug("previous connection is still trying to establish");else{this._previousConnectionAttemptTime=n,this.socket&&this.destroy(),this.options.options.reconnection=!0,this.options.options.reconnectionDelay=Fe.RECONNECT_DELAY,this.options.options.reconnectionDelayMax=1e4,this.options.options.reconnectionAttempts=1/0,this.options.options.transports=["websocket"],this.options.options.timeout=Fe.CLIENT_CONNECT_TIMEOUT,"query"in this.options.options||(this.options.options.query={}),this.options.options.query.version=Ze,this.options.options.query.room=this.options.room;var r=this.options.socket||ve(this.options.url,this.options.options);this.socket=r,this._pendingRequests={},this._pendingRequestsId=0;var o=new Date;r.on("pong",(function(){o=new Date}));var i=setInterval((function(){r!==e.socket?clearInterval(i):new Date-o>3e4&&e.createWebSocketIO()}),15e3);this._onConnect=function(){e.options.initSync&&(e._sentSync=!0,e._previousConnectionAttemptTime=0,ke.debug("Connected to room "+e.options.room),r.emit("joinRoom",e.options.room),e._verifyContentVersion("server"))},r.on("connect",this._onConnect),r.connected?this._onConnect():r.connect();var s=function(){e._previousConnectionAttemptTime=0,e.socketHandlers.connectError(),e.destroy()};r.on("connect_error",s),r.on("connect_timeout",s),this.onRteEvent((function(t){var n=t.type;if(null!=n)switch(n){case"handshake":return void e._handshakeMessageHandler(t);case"lastUpdateMarker":return void e._lastUpdateMarkerMessageHandler(t);case"noteSaved":return void e._noteSavedMessageHandler(t);case"realtimeError":return void e._handleErrorMessage(t);case"realtimePermissionsChanged":return void e._permissionsChangedMessageHandler(t);case"userConnections":return void e._userConnectionsMessageHandler(t);case Qe:return void e._commandMessageHandler(t)}else ke.error("Received message without type specified!")})),r.on("reconnect",this.socketHandlers.reconnect),r.on("reconnect_attempt",this.socketHandlers.reconnectAttempt),r.on("reconnect_error",this.socketHandlers.reconnectError),this._onDisconnect=function(n){ke.debug("got disconnect"),e.destroy(),t.AbstractConnector.prototype.disconnect.call(e)},r.on("disconnect",this._onDisconnect)}}},{key:"initSync",value:function(t){this.options.initSync||(this.options.initSync=!0,null!=t.room&&(this.options.room=t.room)),this.socket.connected&&this._onConnect()}},{key:"disconnect",value:function(){this.socket?(ke.debug("Disconnected from room "+this.options.room),this.socket.emit("leaveRoom",this.options.room),this._disconnect()):ke.error("Trying to disconnect when socket has been destroyed.")}},{key:"destroy",value:function(){var t=this;this.socket&&(this.socket.off("disconnect",this._onDisconnect),this.socket.off("yjsEvent",this._onYjsEvent),this.rteEvents.forEach((function(e){return t.socket.off("rteEvent",e)})),this.rteEvents=[],this.socket.off("connect",this._onConnect),this.options.socket||(this.socket.close(),this.socket.destroy()),this._disconnect(),this.socket=null)}},{key:"reconnect",value:function(){ke.debug("Reconnect"),C(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"reconnect",this).call(this)}},{key:"sendRteEvent",value:function(t){t.room=this.options.room,this.socket.emit("rteEvent",t)}},{key:"onRteEvent",value:function(t){this.rteEvents.push(t),this.socket.on("rteEvent",t)}},{key:"send",value:function(t,e){if(this._sentSync){if(!this.socket)return void ke.error("Trying to send message "+e+" when socket has been destroyed.");this.socket.emit("yjsEvent",e),C(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"send",this).call(this,t,e)}}},{key:"broadcast",value:function(t){if(this._sentSync){if(!this.socket)return void ke.error("Trying to broadcast message "+t+" when socket has been destroyed.");this.socket.emit("yjsEvent",t),C(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"broadcast",this).call(this,t)}}},{key:"whenRemoteResponsive",value:function(){var t=this;return new Promise((function(e){t.socket.emit("yjsResponsive",t.options.room,e)}))}},{key:"isDisconnected",value:function(){return this.socket.disconnected}},{key:"sendDeleteNoteMessage",value:function(){this.socket?this.sendRteEvent({type:"deleteNote",contentVersion:this.contentVersion,protocolVersion:this.protocolVersion,auth:this.authInfo}):ke.error("Trying to send delete note message when socket has been destroyed.")}},{key:"updateAuthToken",value:function(t){this.options.authToken=t,this.socket&&this.sendRteEvent({type:"updateAuthToken",contentVersion:this.contentVersion,protocolVersion:this.protocolVersion,authToken:this.options.authToken})}},{key:"executeCommand",value:function(t,e){var n=this;return new Promise((function(r,o){if(!n.socket)return ke.error("Trying to execute command when socket has been destroyed."),o();var i=n._pendingRequestsId++;n.sendRteEvent({type:Qe,requestID:i,command:t,data:e}),n._pendingRequests[i]=r}))}},{key:"updateUserConnectionsIfNeeded",value:function(t){this.socket?this.sendRteEvent({type:"updateUserConnections",contentVersion:this.contentVersion,protocolVersion:this.protocolVersion,auth:this.authInfo,timestamp:t}):ke.error("Trying to update user connections when socket has been destroyed.")}},{key:"debugDisconnect",value:function(){this._tornDown=!0,this.destroy()}},{key:"debugReconnect",value:function(){this._tornDown=!1,this._setupReconnectWatchdog()}},{key:"_handleErrorMessage",value:function(t){switch(t.errorDomain){case Je.INTERNAL:this.destroy(),null!=t.reconnectTimeout&&(this._reconnectTimeout=t.reconnectTimeout,this._setupReconnectWatchdog());break;case Je.SESSION:this.utilities.errorHandler(Ge(t.errorCode));break;default:ke.error("Unknown RTE server error!"),this.destroy()}}},{key:"_verifyContentVersion",value:function(t){var e=this;if(this.socket){this.handshakeTimeout=setTimeout(this._handshakeTimeoutHandler,Fe.HANDSHAKE_TIMEOUT_INTERVAL);var n=null,r=null;this._noteContentInfo.getContentHash().then((function(t){return n=t,e._noteContentInfo.getSessionID()})).then((function(t){r=t})).then((function(){e.sendRteEvent({type:"handshake",contentVersion:e.contentVersion,protocolVersion:e.protocolVersion,auth:e.authInfo,authToken:e.options.authToken,businessAuthToken:e.options.businessAuthToken,serviceHost:e.options.serviceHost,shardID:e.options.shardID,userName:e.options.userName,sessionID:r,clientID:e.clientID,newNote:e.options.newNote,notebookGuid:e.options.notebookGuid,noteTitle:e.options.noteTitle,contentHash:n,platform:e.options.platform})}))}else ke.error("Trying to send handshake message when socket has been destroyed.")}},{key:"_handshakeTimeoutHandler",value:function(){this.handshakeTimeout=null,this.socketHandlers.connect(!1),this.destroy()}},{key:"_shouldReconnect",value:function(){return!this._tornDown&&!1!==this.options.should_reconnect}},{key:"_clearReconnectWatchdog",value:function(){this._reconnectInterval&&(clearInterval(this._reconnectInterval),this._reconnectInterval=null)}},{key:"_setupReconnectWatchdog",value:function(){var t=this;this._clearReconnectWatchdog(),this._reconnectTimeout<0||(this._reconnectInterval=setInterval((function(){t._shouldReconnect()&&!t.socket&&t.createWebSocketIO()}),this._reconnectTimeout))}},{key:"_disconnect",value:function(){this.socketHandlers.disconnect(),this.options.socket||this.socket.disconnect(),C(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"disconnect",this).call(this)}},{key:"_setupYJSEventsHandlers",value:function(){this._yjsSyncedEventHandler=this._yjsSyncedEventHandler.bind(this),this.y.on("synced",this._yjsSyncedEventHandler),this._yjsAfterTransactionEventHandler=this._yjsAfterTransactionEventHandler.bind(this),this.y.on("afterTransaction",this._yjsAfterTransactionEventHandler),this._yjsErrorEventHandler=this._yjsErrorEventHandler.bind(this),this.y.on("error",this._yjsErrorEventHandler)}},{key:"_yjsSyncedEventHandler",value:function(){var t=this;this.socketHandlers.connect(!0),this._noteContentInfo.getContentDirty().then((function(e){t._syncMetadata.contentDirty=e,e&&t.sendRteEvent({type:"bumpUpdateMarker"})}))}},{key:"_yjsAfterTransactionEventHandler",value:function(e,n){this.y===e?n.changedParentTypes.has(e.define("content",t.Map))&&(this._syncMetadata.contentDirty=!0,this._noteContentInfo.setContentDirty(!0)):ke.error("Trying to handle YJS 'afterTransaction' event for wrong Y-instance.")}},{key:"_yjsErrorEventHandler",value:function(t){ke.error("Unexpected YJS error: "+t),this.utilities.errorHandler(Ke(Ie.INTERNAL_FAILURE))}},{key:"_handshakeMessageHandler",value:function(e){var n=this;if(null!=e){var r=!!e.accepted;ke.debug("Received handshake response: "+JSON.stringify(e)),ke.debug("message.accpeted = "+r),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=null,r?(this._noteContentInfo.setSessionID(e.sessionID),this.serverVersion=e.serverVersion,this._businessID=null!=e.businessID?e.businessID:null,null!=e.contentHash&&this._noteContentInfo.setContentHash(e.contentHash),null!=e.syncMetadata&&this._updateClientSyncMetadata(e.syncMetadata),this.utilities.permissionsHandler(!1===e.canEditNote),this.userJoined("server","master"),null!=this._onYjsEvent&&this.socket.off("yjsEvent",this._onYjsEvent),this._onYjsEvent=function(e){new t.utils.BinaryDecoder(e).readVarString()===n.options.room&&n.receiveMessage("server",e)},this.socket.on("yjsEvent",this._onYjsEvent)):(e.errorCode===Xe.INCOMPATIBLE_MODEL?this.utilities.resetYjsModel():$e(e.errorCode)||this.utilities.errorHandler(Ge(e.errorCode)),this.socketHandlers.connect(!1),this.destroy())}}},{key:"_updateClientSyncMetadata",value:function(t){this._syncMetadata.contentHash=t.contentHash,this._syncMetadata.lastEditedBy=t.lastEditedBy,this._syncMetadata.updated=t.updated,this._syncMetadata.updateSequenceNumber=t.updateSequenceNumber;var e=this.lastUpdateMarker>=0&&this.lastUpdateMarker>t.updateMarker;this._syncMetadata.contentDirty=e,this._noteContentInfo.setContentDirty(e)}},{key:"_noteSavedMessageHandler",value:function(t){if(null!=t){this._updateClientSyncMetadata(t);var e=t.contentHash;this._noteContentInfo.setContentHash(e),this.syncMetadata.contentDirty||this.utilities.noteSavedNotification(this._syncMetadata)}}},{key:"_lastUpdateMarkerMessageHandler",value:function(t){null!=t&&(this.lastUpdateMarker=t.updateMarker)}},{key:"_permissionsChangedMessageHandler",value:function(t){null!=t&&this.utilities.permissionsHandler(!1===t.canEditNote)}},{key:"_userConnectionsMessageHandler",value:function(t){null!=t&&this.utilities.userConnectionsHandler(t.userConnections,t.timestamp)}},{key:"_commandMessageHandler",value:function(t){if(null!=t){var e=this._pendingRequests[t.requestID];e?(e(t),delete this._pendingRequests[t.requestID]):ke.error("Didn't find handler for "+t)}}},{key:"businessID",get:function(){return this._businessID}},{key:"syncMetadata",get:function(){return this._syncMetadata}}]),n}(t.AbstractConnector);e.io=ve,t["websockets-client"]=e}var E="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},O=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,T=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],A=function(t){var e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));for(var o=O.exec(t||""),i={},s=14;s--;)i[T[s]]=o[s]||"";return-1!=n&&-1!=r&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i},I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},B=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),C=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},D=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},U=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},x=1e3,P=60*x,R=60*P,j=24*R,M=365.25*j,L=function(t,e){e=e||{};var n=void 0===t?"undefined":I(t);if("string"===n&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*M;case"days":case"day":case"d":return n*j;case"hours":case"hour":case"hrs":case"hr":case"h":return n*R;case"minutes":case"minute":case"mins":case"min":case"m":return n*P;case"seconds":case"second":case"secs":case"sec":case"s":return n*x;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(t);if("number"===n&&!1===isNaN(t))return e.long?r(t):function(t){return t>=j?Math.round(t/j)+"d":t>=R?Math.round(t/R)+"h":t>=P?Math.round(t/P)+"m":t>=x?Math.round(t/x)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))},H=t((function(t,e){function n(t){function n(){if(n.enabled){var t=n,o=+new Date,i=o-(r||o);t.diff=i,t.prev=r,t.curr=o,r=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var o=e.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(t,i),s.splice(c,1),c--}return n})),e.formatArgs.call(t,s),(n.log||e.log||console.log.bind(console)).apply(t,s)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),"function"==typeof e.init&&e.init(n),n}var r;(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){e.save(t),e.names=[],e.skips=[];for(var n=("string"==typeof t?t:"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&("-"===(t=n[o].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=L,e.names=[],e.skips=[],e.formatters={}})),V=t((function(t,e){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==n&&"env"in n&&(t=Object({NODE_ENV:"production",CE_VERSION:"91.0.11335",TEST:!1,WALLABY:!1,SKIP_SLOW_TESTS:void 0,EDITOR:"peso",TEST_CATEGORIES:[]}).DEBUG),t}(e=t.exports=H).log=function(){return"object"===("undefined"==typeof console?"undefined":I(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var o=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))})),t.splice(i,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(r())})),q=V("socket.io-client:url"),W=function(t,e){var n=t;e=e||E.location,null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(q("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),q("parse %s",t),n=A(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(e&&e.port===n.port?"":":"+n.port),n},z=t((function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,o=0;o<n.length;o++)if((r=n[o])===e||r.fn===e){n.splice(o,1);break}return this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,e);return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}})),J={}.toString,X=Array.isArray||function(t){return"[object Array]"==J.call(t)},F=Object.prototype.toString,K="function"==typeof E.Blob||"[object BlobConstructor]"===F.call(E.Blob),G="function"==typeof E.File||"[object FileConstructor]"===F.call(E.File),$=function t(e){if(!e||"object"!==(void 0===e?"undefined":I(e)))return!1;if(X(e)){for(var n=0,r=e.length;n<r;n++)if(t(e[n]))return!0;return!1}if("function"==typeof E.Buffer&&E.Buffer.isBuffer&&E.Buffer.isBuffer(e)||"function"==typeof E.ArrayBuffer&&e instanceof ArrayBuffer||K&&e instanceof Blob||G&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&t(e[o]))return!0;return!1},Z={}.toString,Q=Array.isArray||function(t){return"[object Array]"==Z.call(t)},tt=function(t){return E.Buffer&&E.Buffer.isBuffer(t)||E.ArrayBuffer&&t instanceof ArrayBuffer},et=Object.prototype.toString,nt="function"==typeof E.Blob||"[object BlobConstructor]"===et.call(E.Blob),rt="function"==typeof E.File||"[object FileConstructor]"===et.call(E.File),ot={deconstructPacket:function(t){var e=[],n=t.data,r=t;return r.data=function t(e,n){if(!e)return e;if(tt(e)){var r={_placeholder:!0,num:n.length};return n.push(e),r}if(Q(e)){for(var o=new Array(e.length),i=0;i<e.length;i++)o[i]=t(e[i],n);return o}if("object"===(void 0===e?"undefined":I(e))&&!(e instanceof Date)){for(var s in o={},e)o[s]=t(e[s],n);return o}return e}(n,e),r.attachments=e.length,{packet:r,buffers:e}},reconstructPacket:function(t,e){return t.data=function t(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(Q(e))for(var r=0;r<e.length;r++)e[r]=t(e[r],n);else if("object"===(void 0===e?"undefined":I(e)))for(var o in e)e[o]=t(e[o],n);return e}(t.data,e),t.attachments=void 0,t},removeBlobs:function(t,e){var n=0,r=t;(function t(o,i,s){if(!o)return o;if(nt&&o instanceof Blob||rt&&o instanceof File){n++;var a=new FileReader;a.onload=function(){s?s[i]=this.result:r=this.result,--n||e(r)},a.readAsArrayBuffer(o)}else if(Q(o))for(var c=0;c<o.length;c++)t(o[c],c,o);else if("object"===(void 0===o?"undefined":I(o))&&!tt(o))for(var u in o)t(o[u],u,o)})(r),n||e(r)}},it=t((function(t,e){function n(){}function r(t){var n=""+t.type;return e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data&&(n+=JSON.stringify(t.data)),c("encoded %j as %s",t,n),n}function o(){this.reconstructor=null}function i(t){var n=0,r={type:Number(t.charAt(0))};if(null==e.types[r.type])return a();if(e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type){for(var o="";"-"!==t.charAt(++n)&&(o+=t.charAt(n),n!=t.length););if(o!=Number(o)||"-"!==t.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(o)}if("/"===t.charAt(n+1))for(r.nsp="";++n&&","!==(s=t.charAt(n))&&(r.nsp+=s,n!==t.length););else r.nsp="/";var i=t.charAt(n+1);if(""!==i&&Number(i)==i){for(r.id="";++n;){var s;if(null==(s=t.charAt(n))||Number(s)!=s){--n;break}if(r.id+=t.charAt(n),n===t.length)break}r.id=Number(r.id)}return t.charAt(++n)&&(r=function(t,e){try{t.data=JSON.parse(e)}catch(t){return a()}return t}(r,t.substr(n))),c("decoded %s as %j",t,r),r}function s(t){this.reconPack=t,this.buffers=[]}function a(){return{type:e.ERROR,data:"parser error"}}var c=V("socket.io-parser");e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=n,e.Decoder=o,n.prototype.encode=function(t,n){t.type!==e.EVENT&&t.type!==e.ACK||!$(t.data)||(t.type=t.type===e.EVENT?e.BINARY_EVENT:e.BINARY_ACK),c("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?function(t,e){ot.removeBlobs(t,(function(t){var n=ot.deconstructPacket(t),o=r(n.packet),i=n.buffers;i.unshift(o),e(i)}))}(t,n):n([r(t)])},z(o.prototype),o.prototype.add=function(t){var n;if("string"==typeof t)n=i(t),e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type?(this.reconstructor=new s(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!tt(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",n))}},o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},s.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=ot.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},s.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}})),st=t((function(t){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}})),at=function(t){var e=t.xdomain,n=t.xscheme,r=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||st))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(t){}if(!e)try{return new(E[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}},ct=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e},ut=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(t),i=new Uint8Array(n-e),s=e,a=0;s<n;s++,a++)i[a]=o[s];return i.buffer},lt=function(t,e,n){function r(t,i){if(r.count<=0)throw new Error("after called too many times");--r.count,t?(o=!0,e(t),e=n):0!==r.count||o||e(null,i)}var o=!1;return n=n||i,r.count=t,0===t?e():r},ht=t((function(t,e){!function(n){function r(t){for(var e,n,r=[],o=0,i=t.length;o<i;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<i?56320==(64512&(n=t.charCodeAt(o++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--):r.push(e);return r}function o(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function i(t,e){return y(t>>e&63|128)}function s(t,e){if(0==(4294967168&t))return y(t);var n="";return 0==(4294965248&t)?n=y(t>>6&31|192):0==(4294901760&t)?(o(t,e)||(t=65533),n=y(t>>12&15|224),n+=i(t,6)):0==(4292870144&t)&&(n=y(t>>18&7|240),n+=i(t,12),n+=i(t,6)),n+y(63&t|128)}function a(){if(p>=d)throw Error("Invalid byte index");var t=255&f[p];if(p++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function c(t){var e,n;if(p>d)throw Error("Invalid byte index");if(p==d)return!1;if(e=255&f[p],p++,0==(128&e))return e;if(192==(224&e)){if((n=(31&e)<<6|a())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&e)){if((n=(15&e)<<12|a()<<6|a())>=2048)return o(n,t)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=(7&e)<<18|a()<<12|a()<<6|a())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var u=e,l=t&&t.exports==u&&t,h="object"==I(E)&&E;h.global!==h&&h.window!==h||(n=h);var f,d,p,y=String.fromCharCode,v={version:"2.1.2",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,o=r(t),i=o.length,a=-1,c="";++a<i;)c+=s(o[a],n);return c},decode:function(t,e){var n=!1!==(e=e||{}).strict;f=r(t),d=f.length,p=0;for(var o,i=[];!1!==(o=c(n));)i.push(o);return function(t){for(var e,n=t.length,r=-1,o="";++r<n;)(e=t[r])>65535&&(o+=y((e-=65536)>>>10&1023|55296),e=56320|1023&e),o+=y(e);return o}(i)}};if(u&&!u.nodeType)if(l)l.exports=v;else{var _={}.hasOwnProperty;for(var g in v)_.call(v,g)&&(u[g]=v[g])}else n.utf8=v}(E)})),ft=t((function(t,e){!function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),o=r.length,i="";for(n=0;n<o;n+=3)i+=t[r[n]>>2],i+=t[(3&r[n])<<4|r[n+1]>>4],i+=t[(15&r[n+1])<<2|r[n+2]>>6],i+=t[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(t){var e,r,o,i,s,a=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var l=new ArrayBuffer(a),h=new Uint8Array(l);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],o=n[t.charCodeAt(e+1)],i=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],h[u++]=r<<2|o>>4,h[u++]=(15&o)<<4|i>>2,h[u++]=(3&i)<<6|63&s;return l}}()})),dt=E.BlobBuilder||E.WebKitBlobBuilder||E.MSBlobBuilder||E.MozBlobBuilder,pt=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),yt=pt&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),vt=dt&&dt.prototype.append&&dt.prototype.getBlob,_t=pt?yt?E.Blob:c:vt?a:void 0,gt=t((function(t,e){function n(t,n){return n("b"+e.packets[t.type]+t.data.data)}function r(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=t.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=l[t.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return r(s.buffer)}function o(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(u)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var o=new FileReader;return o.onload=function(){t.data=o.result,e.encodePacket(t,n,!0,r)},o.readAsArrayBuffer(t.data)}(t,n,r);var o=new Uint8Array(1);return o[0]=l[t.type],r(new _t([o.buffer,t.data]))}function i(t,e,n){for(var r=new Array(t.length),o=lt(t.length,n),i=0;i<t.length;i++)!function(t,n,o){e(n,(function(e,n){r[t]=n,o(e,r)}))}(i,t[i],o)}var s;E&&E.ArrayBuffer&&(s=ft);var a="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),c="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=a||c;e.protocol=3;var l=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},h=ct(l),f={type:"error",data:"parser error"};e.encodePacket=function(t,e,i,s){"function"==typeof e&&(s=e,e=!1),"function"==typeof i&&(s=i,i=null);var a=void 0===t.data?void 0:t.data.buffer||t.data;if(E.ArrayBuffer&&a instanceof ArrayBuffer)return r(t,e,s);if(_t&&a instanceof E.Blob)return o(t,e,s);if(a&&a.base64)return n(t,s);var c=l[t.type];return void 0!==t.data&&(c+=i?ht.encode(String(t.data),{strict:!1}):String(t.data)),s(""+c)},e.encodeBase64Packet=function(t,n){var r,o="b"+e.packets[t.type];if(_t&&t.data instanceof E.Blob){var i=new FileReader;return i.onload=function(){var t=i.result.split(",")[1];n(o+t)},i.readAsDataURL(t.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var s=new Uint8Array(t.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];r=String.fromCharCode.apply(null,a)}return o+=E.btoa(r),n(o)},e.decodePacket=function(t,n,r){if(void 0===t)return f;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(r&&!1===(t=function(t){try{t=ht.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return f;var o=t.charAt(0);return Number(o)==o&&h[o]?t.length>1?{type:h[o],data:t.substring(1)}:{type:h[o]}:f}o=new Uint8Array(t)[0];var i=ut(t,1);return _t&&"blob"===n&&(i=new _t([i])),{type:h[o],data:i}},e.decodeBase64Packet=function(t,e){var n=h[t.charAt(0)];if(!s)return{type:n,data:{base64:!0,data:t.substr(1)}};var r=s.decode(t.substr(1));return"blob"===e&&_t&&(r=new _t([r])),{type:n,data:r}},e.encodePayload=function(t,n,r){"function"==typeof n&&(r=n,n=null);var o=$(t);return n&&o?_t&&!u?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r):t.length?void i(t,(function(t,r){e.encodePacket(t,!!o&&n,!1,(function(t){r(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return r(e.join(""))})):r("0:")},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);var o;if("function"==typeof n&&(r=n,n=null),""===t)return r(f,0,1);for(var i,s,a="",c=0,u=t.length;c<u;c++){var l=t.charAt(c);if(":"===l){if(""===a||a!=(i=Number(a)))return r(f,0,1);if(a!=(s=t.substr(c+1,i)).length)return r(f,0,1);if(s.length){if(o=e.decodePacket(s,n,!1),f.type===o.type&&f.data===o.data)return r(f,0,1);if(!1===r(o,c+i,u))return}c+=i,a=""}else a+=l}return""!==a?r(f,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){if(!t.length)return n(new ArrayBuffer(0));i(t,(function(t,n){e.encodePacket(t,!0,!0,(function(t){return n(null,t)}))}),(function(t,e){var r=e.reduce((function(t,e){var n;return t+(n="string"==typeof e?e.length:e.byteLength).toString().length+n+2}),0),o=new Uint8Array(r),i=0;return e.forEach((function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),s=0;s<t.length;s++)r[s]=t.charCodeAt(s);n=r.buffer}o[i++]=e?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)o[i++]=parseInt(a[s]);for(o[i++]=255,r=new Uint8Array(n),s=0;s<r.length;s++)o[i++]=r[s]})),n(o.buffer)}))},e.encodePayloadAsBlob=function(t,n){i(t,(function(t,n){e.encodePacket(t,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);t=r.buffer,e[0]=0}var i=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),s=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)s[o]=parseInt(i[o]);if(s[i.length]=255,_t){var a=new _t([e.buffer,s.buffer,t]);n(null,a)}}))}),(function(t,e){return n(new _t(e))}))},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var o=t,i=[];o.byteLength>0;){for(var s=new Uint8Array(o),a=0===s[0],c="",u=1;255!==s[u];u++){if(c.length>310)return r(f,0,1);c+=s[u]}o=ut(o,2+c.length),c=parseInt(c);var l=ut(o,0,c);if(a)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(t){var h=new Uint8Array(l);for(l="",u=0;u<h.length;u++)l+=String.fromCharCode(h[u])}i.push(l),o=ut(o,c)}var d=i.length;i.forEach((function(t,o){r(e.decodePacket(t,n,!0),o,d)}))}})),mt=u;z(u.prototype),u.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},u.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},u.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},u.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},u.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},u.prototype.onData=function(t){var e=gt.decodePacket(t,this.socket.binaryType);this.onPacket(e)},u.prototype.onPacket=function(t){this.emit("packet",t)},u.prototype.onClose=function(){this.readyState="closed",this.emit("close")};for(var bt,kt={encode:function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},decode:function(t){for(var e={},n=t.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}},wt=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t},St="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Et=64,Ot={},Tt=0,At=0;At<Et;At++)Ot[St[At]]=At;h.encode=l,h.decode=function(t){var e=0;for(At=0;At<t.length;At++)e=e*Et+Ot[t.charAt(At)];return e};var It=h,Nt=V("engine.io-client:polling"),Bt=f,Ct=null!=new at({xdomain:!1}).responseType;wt(f,mt),f.prototype.name="polling",f.prototype.doOpen=function(){this.poll()},f.prototype.pause=function(t){function e(){Nt("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(Nt("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){Nt("pre-pause polling complete"),--r||e()}))),this.writable||(Nt("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){Nt("pre-pause writing complete"),--r||e()})))}else e()},f.prototype.poll=function(){Nt("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},f.prototype.onData=function(t){var e=this;Nt("polling got data %s",t),gt.decodePayload(t,this.socket.binaryType,(function(t,n,r){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():Nt('ignoring poll - transport state "%s"',this.readyState))},f.prototype.doClose=function(){function t(){Nt("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(Nt("transport open - closing"),t()):(Nt("transport not open - deferring close"),this.once("open",t))},f.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};gt.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,n)}))},f.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=It()),this.supportsBinary||t.sid||(t.b64=1),t=kt.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t};var Dt=V("engine.io-client:polling-xhr"),Ut=p,xt=y;wt(p,Bt),p.prototype.supportsBinary=!0,p.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new y(t)},p.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),o=this;r.on("success",e),r.on("error",(function(t){o.onError("xhr post error",t)})),this.sendXhr=r},p.prototype.doPoll=function(){Dt("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},z(y.prototype),y.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new at(t),n=this;try{Dt("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=!0),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState){var t;try{t=e.getResponseHeader("Content-Type")}catch(t){}"application/octet-stream"===t&&(e.responseType="arraybuffer")}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout((function(){n.onError(e.status)}),0))},Dt("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){n.onError(t)}),0)}E.document&&(this.index=y.requestsCount++,y.requests[this.index]=this)},y.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},y.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},y.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},y.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,t)try{this.xhr.abort()}catch(t){}E.document&&delete y.requests[this.index],this.xhr=null}},y.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},y.prototype.hasXDR=function(){return void 0!==E.XDomainRequest&&!this.xs&&this.enablesXDR},y.prototype.abort=function(){this.cleanup()},y.requestsCount=0,y.requests={},E.document&&(E.attachEvent?E.attachEvent("onunload",v):E.addEventListener&&E.addEventListener("beforeunload",v,!1)),Ut.Request=xt;var Pt,Rt=g,jt=/\n/g,Mt=/\\n/g;wt(g,Bt),g.prototype.supportsBinary=!1,g.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Bt.prototype.doClose.call(this)},g.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},g.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(t){o.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(t)}catch(t){(i=document.createElement("iframe")).name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),t=t.replace(Mt,"\\\n"),this.area.value=t.replace(jt,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===o.iframe.readyState&&n()}:this.iframe.onload=n};var Lt,Ht={},Vt=Object.freeze({default:Ht}),qt=Vt&&Ht||Vt,Wt=V("engine.io-client:websocket"),Yt=E.WebSocket||E.MozWebSocket;if("undefined"==typeof window)try{Lt=qt}catch(t){}var zt=Yt;zt||"undefined"!=typeof window||(zt=Lt);var Jt=m;wt(m,mt),m.prototype.name="websocket",m.prototype.supportsBinary=!0,m.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?e?new zt(t,e):new zt(t):new zt(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},m.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},m.prototype.write=function(t){var e=this;this.writable=!1;for(var n=t.length,r=0,o=n;r<o;r++)!function(t){gt.encodePacket(t,e.supportsBinary,(function(r){if(!e.usingBrowserWebSocket){var o={};t.options&&(o.compress=t.options.compress),e.perMessageDeflate&&("string"==typeof r?E.Buffer.byteLength(r):r.length)<e.perMessageDeflate.threshold&&(o.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(r):e.ws.send(r,o)}catch(t){Wt("websocket closed before onclose event")}--n||(e.emit("flush"),setTimeout((function(){e.writable=!0,e.emit("drain")}),0))}))}(t[r])},m.prototype.onClose=function(){mt.prototype.onClose.call(this)},m.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},m.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=It()),this.supportsBinary||(t.b64=1),(t=kt.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},m.prototype.check=function(){return!(!zt||"__initialize"in zt&&this.name===m.prototype.name)};var Xt={polling:function(t){var e=!1,n=!1,r=!1!==t.jsonp;if(E.location){var o="https:"===location.protocol,i=location.port;i||(i=o?443:80),e=t.hostname!==location.hostname||i!==t.port,n=t.secure!==o}if(t.xdomain=e,t.xscheme=n,"open"in new at(t)&&!t.forceJSONP)return new Ut(t);if(!r)throw new Error("JSONP disabled");return new Rt(t)},websocket:Jt},Ft=[].indexOf,Kt=function(t,e){if(Ft)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1},Gt=/^[\],:{}\s]*$/,$t=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,Zt=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Qt=/(?:^|:|,)(?:\s*\[)+/g,te=/^\s+/,ee=/\s+$/,ne=V("engine.io-client:socket"),re=b;b.priorWebsocketSuccess=!1,z(b.prototype),b.protocol=gt.protocol,b.Socket=b,b.Transport=mt,b.transports=Xt,b.parser=gt,b.prototype.createTransport=function(t){ne('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=gt.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new Xt[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},b.prototype.open=function(){var t;if(this.rememberUpgrade&&b.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},b.prototype.setTransport=function(t){ne("setting transport %s",t.name);var e=this;this.transport&&(ne("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},b.prototype.probe=function(t){function e(){if(l.onlyBinaryUpgrades){var e=!this.supportsBinary&&l.transport.supportsBinary;u=u||e}u||(ne('probe transport "%s" opened',t),c.send([{type:"ping",data:"probe"}]),c.once("packet",(function(e){if(!u)if("pong"===e.type&&"probe"===e.data){if(ne('probe transport "%s" pong',t),l.upgrading=!0,l.emit("upgrading",c),!c)return;b.priorWebsocketSuccess="websocket"===c.name,ne('pausing current transport "%s"',l.transport.name),l.transport.pause((function(){u||"closed"!==l.readyState&&(ne("changing transport and sending upgrade packet"),a(),l.setTransport(c),c.send([{type:"upgrade"}]),l.emit("upgrade",c),c=null,l.upgrading=!1,l.flush())}))}else{ne('probe transport "%s" failed',t);var n=new Error("probe error");n.transport=c.name,l.emit("upgradeError",n)}})))}function n(){u||(u=!0,a(),c.close(),c=null)}function r(e){var r=new Error("probe error: "+e);r.transport=c.name,n(),ne('probe transport "%s" failed because of error: %s',t,e),l.emit("upgradeError",r)}function o(){r("transport closed")}function i(){r("socket closed")}function s(t){c&&t.name!==c.name&&(ne('"%s" works - aborting "%s"',t.name,c.name),n())}function a(){c.removeListener("open",e),c.removeListener("error",r),c.removeListener("close",o),l.removeListener("close",i),l.removeListener("upgrading",s)}ne('probing transport "%s"',t);var c=this.createTransport(t,{probe:1}),u=!1,l=this;b.priorWebsocketSuccess=!1,c.once("open",e),c.once("error",r),c.once("close",o),this.once("close",i),this.once("upgrading",s),c.open()},b.prototype.onOpen=function(){if(ne("socket open"),this.readyState="open",b.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){ne("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},b.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(ne('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(function(t){return"string"==typeof t&&t?(t=t.replace(te,"").replace(ee,""),E.JSON&&JSON.parse?JSON.parse(t):Gt.test(t.replace($t,"@").replace(Zt,"]").replace(Qt,""))?new Function("return "+t)():void 0):null}(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else ne('packet received with socket readyState "%s"',this.readyState)},b.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},b.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},b.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){ne("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},b.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},b.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},b.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(ne("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},b.prototype.write=b.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},b.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:t,data:e,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},b.prototype.close=function(){function t(){r.onClose("forced close"),ne("socket closing - telling transport to close"),r.transport.close()}function e(){r.removeListener("upgrade",e),r.removeListener("upgradeError",e),t()}function n(){r.once("upgrade",e),r.once("upgradeError",e)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():t()})):this.upgrading?n():t()}return this},b.prototype.onError=function(t){ne("socket error %j",t),b.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},b.prototype.onClose=function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(ne('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},b.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~Kt(this.transports,t[n])&&e.push(t[n]);return e};var oe=re,ie=gt;oe.parser=ie;var se=oe,ae=function(t,e){for(var n=[],r=(e=e||0)||0;r<t.length;r++)n[r-e]=t[r];return n},ce=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}},ue=[].slice,le=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=ue.call(arguments,2);return function(){return e.apply(t,n.concat(ue.call(arguments)))}},he=t((function(t,e){function n(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var r=V("socket.io-client:socket");t.exports=n;var o={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},i=z.prototype.emit;z(n.prototype),n.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[ce(t,"open",le(this,"onopen")),ce(t,"packet",le(this,"onpacket")),ce(t,"close",le(this,"onclose"))]}},n.prototype.open=n.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},n.prototype.send=function(){var t=ae(arguments);return t.unshift("message"),this.emit.apply(this,t),this},n.prototype.emit=function(t){if(o.hasOwnProperty(t))return i.apply(this,arguments),this;var e=ae(arguments),n={type:it.EVENT,data:e,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(r("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),delete this.flags,this},n.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},n.prototype.onopen=function(){if(r("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"===I(this.query)?kt.encode(this.query):this.query;r("sending connect packet with query %s",t),this.packet({type:it.CONNECT,query:t})}else this.packet({type:it.CONNECT})},n.prototype.onclose=function(t){r("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},n.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case it.CONNECT:this.onconnect();break;case it.EVENT:case it.BINARY_EVENT:this.onevent(t);break;case it.ACK:case it.BINARY_ACK:this.onack(t);break;case it.DISCONNECT:this.ondisconnect();break;case it.ERROR:this.emit("error",t.data)}},n.prototype.onevent=function(t){var e=t.data||[];r("emitting event %j",e),null!=t.id&&(r("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?i.apply(this,e):this.receiveBuffer.push(e)},n.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var o=ae(arguments);r("sending ack %j",o),e.packet({type:it.ACK,id:t,data:o})}}},n.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(r("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):r("bad ack %s",t.id)},n.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},n.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)i.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},n.prototype.ondisconnect=function(){r("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},n.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},n.prototype.close=n.prototype.disconnect=function(){return this.connected&&(r("performing disconnect (%s)",this.nsp),this.packet({type:it.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},n.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this}})),fe=k;k.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},k.prototype.reset=function(){this.attempts=0},k.prototype.setMin=function(t){this.ms=t},k.prototype.setMax=function(t){this.max=t},k.prototype.setJitter=function(t){this.jitter=t};var de=V("socket.io-client:manager"),pe=Object.prototype.hasOwnProperty,ye=w;w.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)pe.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},w.prototype.updateSocketIds=function(){for(var t in this.nsps)pe.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},w.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},z(w.prototype),w.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},w.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},w.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},w.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},w.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},w.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},w.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},w.prototype.open=w.prototype.connect=function(t,e){if(de("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;de("opening %s",this.uri),this.engine=se(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=ce(n,"open",(function(){r.onopen(),t&&t()})),i=ce(n,"error",(function(e){if(de("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var s=this._timeout;de("connect attempt will timeout after %d",s);var a=setTimeout((function(){de("connect attempt timed out after %d",s),o.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",s)}),s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(o),this.subs.push(i),this},w.prototype.onopen=function(){de("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(ce(t,"data",le(this,"ondata"))),this.subs.push(ce(t,"ping",le(this,"onping"))),this.subs.push(ce(t,"pong",le(this,"onpong"))),this.subs.push(ce(t,"error",le(this,"onerror"))),this.subs.push(ce(t,"close",le(this,"onclose"))),this.subs.push(ce(this.decoder,"decoded",le(this,"ondecoded")))},w.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},w.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},w.prototype.ondata=function(t){this.decoder.add(t)},w.prototype.ondecoded=function(t){this.emit("packet",t)},w.prototype.onerror=function(t){de("error",t),this.emitAll("error",t)},w.prototype.socket=function(t,e){function n(){~Kt(o.connecting,r)||o.connecting.push(r)}var r=this.nsps[t];if(!r){r=new he(this,t,e),this.nsps[t]=r;var o=this;r.on("connecting",n),r.on("connect",(function(){r.id=o.generateId(t)})),this.autoConnect&&n()}return r},w.prototype.destroy=function(t){var e=Kt(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},w.prototype.packet=function(t){de("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()})))},w.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},w.prototype.cleanup=function(){de("cleanup");for(var t=this.subs.length,e=0;e<t;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},w.prototype.close=w.prototype.disconnect=function(){de("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},w.prototype.onclose=function(t){de("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},w.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)de("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();de("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout((function(){t.skipReconnect||(de("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(de("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(de("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(n)}})}},w.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)};var ve=t((function(t,e){function n(t,e){"object"===(void 0===t?"undefined":I(t))&&(e=t,t=void 0),e=e||{};var n,i=W(t),s=i.source,a=i.id,c=i.path,u=o[a]&&c in o[a].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||u?(r("ignoring socket cache for %s",s),n=ye(s,e)):(o[a]||(r("new io instance for %s",s),o[a]=ye(s,e)),n=o[a]),i.query&&!e.query&&(e.query=i.query),n.socket(i.path,e)}var r=V("socket.io-client");t.exports=e=n;var o=e.managers={};e.protocol=it.protocol,e.connect=n,e.Manager=ye,e.Socket=he})),_e={trace:1,debug3:2,debug2:3,debug:4,info:5,warn:6,error:7},ge=function(){return 1==be?function(t){var e=t.split(/\s+/);if(e.length>1){var n=/\(.*\/(.*)\)/g.exec(e[e.length-1]);if(null!=n&&n.length>1)return e[0]+"::"+n[1]}return t}((new Error).stack.split("\n")[4].split("at ")[1].trim()):""},me=4,be=!1,ke=function(){function t(){N(this,t)}return B(t,null,[{key:"setLevel",value:function(t){if(!(t in _e))throw new Error("invalid log type");me=_e[t]}},{key:"showFileAndLineInfo",value:function(t){be=t}},{key:"trace",value:function(t){me<=_e.trace&&console.trace("[RTE]: TRACE "+ge()+" "+t)}},{key:"debug",value:function(t){me<=_e.debug&&console.log("[RTE]: DEBUG "+ge()+" "+t)}},{key:"debug2",value:function(t){me<=_e.debug2&&console.log("[RTE]: DEBUG2 "+ge()+" "+t)}},{key:"debug3",value:function(t){me<=_e.debug3&&console.log("[RTE]: DEBUG3 "+ge()+" "+t)}},{key:"info",value:function(t){me<=_e.info&&console.info("[RTE]: INFO "+ge()+" "+t)}},{key:"warn",value:function(t){me<=_e.warn&&console.warn("[RTE]: WARN "+ge()+" "+t)}},{key:"error",value:function(t){me<=_e.error&&console.error("[RTE]: ERROR "+ge()+" "+t)}}]),t}(),we="dirtyContent",Se="contentHash",Ee="sessionID",Oe=function(){function t(e){N(this,t),this._yInstance=e,this._usePersistence=null!==e.persistence,this._sessionID=null,this._contentHash=null,this._contentDirty=!1}return B(t,[{key:"getContentDirty",value:function(){return this._usePersistence?this._yInstance.persistence.get(this._yInstance,we):Promise.resolve(this._contentDirty)}},{key:"setContentDirty",value:function(t){this._usePersistence?this._yInstance.persistence.set(this._yInstance,we,t):this._contentDirty=t}},{key:"getContentHash",value:function(){return this._usePersistence?this._yInstance.persistence.get(this._yInstance,Se):Promise.resolve(this._contentHash)}},{key:"setContentHash",value:function(t){this._usePersistence?this._yInstance.persistence.set(this._yInstance,Se,t):this._contentHash=t}},{key:"getSessionID",value:function(){return this._usePersistence?this._yInstance.persistence.get(this._yInstance,Ee):Promise.resolve(this._sessionID)}},{key:"setSessionID",value:function(t){this._usePersistence?this._yInstance.persistence.set(this._yInstance,Ee,t):this._sessionID=t}}]),t}(),Te="RealtimeClientDomain",Ae="RealtimeServerDomain",Ie={UNKNOWN:-1,INTERNAL_FAILURE:2},Ne=-1,Be=1,Ce=2,De=4,Ue=5,xe=6,Pe=7,Re=8,je=9,Me=10,Le=11,He=12,Ve=13,qe=14,We=15,Ye=16,ze=17,Je={INTERNAL:0,SESSION:1},Xe={UNKNOWN:-1,AUTH_EXPIRED:0,SESSION_START_DENIED:1,INCOMPATIBLE_MODEL:3,INCOMPATIBLE_CONTENT_CLASS:4,INCOMPLETE_PARAMETERS:5,INVALID_AUTH_HOST:6,INVALID_SERVICE_HOST:7,BLOCKED_ROOM:8,PERMISSION_DENIED:9,INVALID_ENML_GENERATED:10,SHUT_DOWN_ROOM:11,NOTE_SIZE_EXCEEDED:12,SERVICE_UNAVAILABLE:13,INVALID_COMMAND:14,CANNOT_GET_ROOM_LOCK:15,ATTEMPTING_TO_UNLOCK_NOT_OWNED_LOCK:16},Fe={RECONNECT_DELAY:1e3,RECONNECT_WATCHDOG_TIMEOUT:5e3,CLIENT_CONNECT_TIMEOUT:15e3,TIME_TO_COMPLETE_PREVIOUS_CONNECTION_ESTABLISHMENT_BY:2e4,HANDSHAKE_TIMEOUT_INTERVAL:6e5},Ke=function(t){var e=Ie.UNKNOWN,n="Unknown client error. Code: "+t;switch(t){case Ie.INTERNAL_FAILURE:e=t,n="Internal error."}return{code:e,domain:Te,message:n}},Ge=function(t){var e=Ne,n="Unknown server error. Code: "+t;switch(t){case Xe.AUTH_EXPIRED:e=Be,n="Auth token has been expired.";break;case Xe.SESSION_START_DENIED:e=Ce,n="User has no permissions to start RTE session.";break;case Xe.INCOMPATIBLE_MODEL:e=De,n="Client and server have incompatible model states.";break;case Xe.INCOMPATIBLE_CONTENT_CLASS:e=Ue,n="The note was created in a another app.";break;case Xe.INCOMPLETE_PARAMETERS:e=xe,n="Incomplete parameters.";break;case Xe.INVALID_AUTH_HOST:e=Pe,n="Invalid auth host. There is already session for the note with a different service host created.";break;case Xe.INVALID_SERVICE_HOST:e=Re,n="The service host specified is not supported or denied by RTE server.";break;case Xe.BLOCKED_ROOM:e=je,n="The note is blocked by RTE server.";break;case Xe.PERMISSION_DENIED:e=Me,n="Permissions denied.";break;case Xe.INVALID_ENML_GENERATED:e=Le,n="There was an error while generating/persisting ENML.";break;case Xe.SHUT_DOWN_ROOM:e=He,n="Session has been shut down. Try again later.";break;case Xe.NOTE_SIZE_EXCEEDED:e=Ve,n="Exceeded allowed note content size.";break;case Xe.SERVICE_UNAVAILABLE:e=qe,n="Evernote server is unavailable.";break;case Xe.INVALID_COMMAND:e=We,n="Invalid command sent to the server.";break;case Xe.CANNOT_GET_ROOM_LOCK:e=Ye,n="It was not possible to get internal room lock.";break;case Xe.ATTEMPTING_TO_UNLOCK_NOT_OWNED_LOCK:e=ze,n="User tried to release the lock owned by another user."}return{code:e,domain:Ae,message:n}},$e=function(t){return t===Xe.SHUT_DOWN_ROOM||t===Xe.SERVICE_UNAVAILABLE||t===Xe.SESSION_START_DENIED},Ze=10,Qe="plugin";return"undefined"!=typeof Y&&S(Y),S}()}).call(this,n(67),n(139))},776:function(t,e,n){var r=n(817),o=n(1271),i=n(261),s=Object.prototype.toString,a=o((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=s.call(e)),t[e]=n}),r(i));t.exports=a},817:function(t,e){t.exports=function(t){return function(){return t}}}}]);